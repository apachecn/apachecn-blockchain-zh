# ä»¥å¤ªåŠ Dapp ç»ˆææ•™ç¨‹(å¦‚ä½•ä¸€æ­¥ä¸€æ­¥æ„å»ºå…¨æ ˆå»ä¸­å¿ƒåŒ–åº”ç”¨)

> åŸæ–‡ï¼š<https://www.dappuniversity.com/articles/the-ultimate-ethereum-dapp-tutorial>

ä½œè€…æ ¼é›·æˆˆé‡ŒÂ·éº¦å¡å®¾2022 å¹´ 12 æœˆ 1 æ—¥

å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯æ¥è‡ª [Dapp å¤§å­¦çš„](https://www.youtube.com/c/DappUniversity)[Gregory](https://www.twitter.com/DappUniversity)ï¼

ä»Šå¤©æˆ‘å°†å‘ä½ å±•ç¤ºå¦‚ä½•åœ¨ä»¥å¤ªåŠåŒºå—é“¾ä¸Šæ„å»ºä½ çš„ç¬¬ä¸€ä¸ªå»ä¸­å¿ƒåŒ–åº”ç”¨ç¨‹åºï¼Œæˆ– dAppã€‚æˆ‘å°†å‘æ‚¨å±•ç¤ºå¦‚ä½•ç¼–å†™æ‚¨çš„ç¬¬ä¸€ä¸ªä»¥å¤ªåŠæ™ºèƒ½åˆåŒï¼Œå…¶ä¸­æˆ‘ä»¬å°†åœ¨ä¸¤ä¸ªå€™é€‰äººä¹‹é—´è¿›è¡Œé€‰ä¸¾ã€‚æˆ‘ä»¬å°†é’ˆå¯¹æ™ºèƒ½åˆçº¦ç¼–å†™æµ‹è¯•ï¼Œå°†å…¶éƒ¨ç½²åˆ°ä»¥å¤ªåŠåŒºå—é“¾ï¼Œå¹¶å¼€å‘ä¸€ä¸ªå…è®¸å¸æˆ·æŠ•ç¥¨çš„å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºã€‚æˆ‘ä»¬è¿˜å°†ç ”ç©¶ä¸€äº›å…³é”®æ¦‚å¿µï¼Œå¦‚â€œä»€ä¹ˆæ˜¯åŒºå—é“¾ï¼Ÿâ€ï¼Œâ€œä»€ä¹ˆæ˜¯æ™ºèƒ½åˆçº¦ï¼Ÿâ€ï¼Œä»¥åŠâ€œdApp å¦‚ä½•å·¥ä½œï¼Ÿâ€ã€‚

[https://www.youtube.com/embed/3681ZYbDSSk](https://www.youtube.com/embed/3681ZYbDSSk)

[*JOIN MY FREE TRAINING!*](/bootcamp) *

ä½ å¯ä»¥åœ¨ä¸Šé¢ 2 å°æ—¶çš„è§†é¢‘ä¸­çœ‹åˆ°æˆ‘æ„å»ºå®Œæ•´çš„åˆ†æ•£å¼åº”ç”¨ç¨‹åºã€‚åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘è¿˜å°†é€æ­¥æŒ‡å¯¼æ‚¨ã€‚åœ¨æˆ‘ä»¬å¼€å§‹æ„å»ºæˆ‘ä»¬çš„ dApp ä¹‹å‰ï¼Œè®©æˆ‘ä»¬æ£€æŸ¥ä¸€äº›å…³é”®æ¦‚å¿µã€‚å¦‚æœä½ æ¸´æœ›å¼€å§‹ç¼–ç ï¼Œè¯·éšæ„[è·³åˆ°æ•™ç¨‹çš„ä¸‹ä¸€éƒ¨åˆ†](#dependencies)ã€‚ğŸ˜€

ä½ ä¹Ÿå¯ä»¥åœ¨è¿™é‡Œå…è´¹ä¸‹è½½æ‰€æœ‰è§†é¢‘å†…å®¹åˆ°å®Œæ•´çš„ 2 å°æ—¶è§†é¢‘æ•™ç¨‹[ğŸ‰ã€‚](/free-download)

## ä»€ä¹ˆæ˜¯åŒºå—é“¾ï¼Ÿ

è®©æˆ‘ä»¬ç”¨ä¸€ä¸ªç±»æ¯”æ¥ç†è§£ä»€ä¹ˆæ˜¯åŒºå—é“¾ä»¥åŠå®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚è®©æˆ‘ä»¬çœ‹ä¸€ä¸ª web åº”ç”¨ç¨‹åºã€‚

![Web Application Diagram](img/84f11fa421f5c66e39625d383c50ccfe.png)

é€šå¸¸ï¼Œå½“æ‚¨ä¸ web åº”ç”¨ç¨‹åºäº¤äº’æ—¶ï¼Œæ‚¨ä½¿ç”¨ web æµè§ˆå™¨é€šè¿‡ç½‘ç»œè¿æ¥åˆ°ä¸­å¤®æœåŠ¡å™¨ã€‚è¿™ä¸ª web åº”ç”¨ç¨‹åºçš„æ‰€æœ‰ä»£ç éƒ½ä¿å­˜åœ¨è¿™ä¸ªä¸­å¤®æœåŠ¡å™¨ä¸Šï¼Œæ‰€æœ‰æ•°æ®éƒ½ä¿å­˜åœ¨ä¸€ä¸ªä¸­å¤®æ•°æ®åº“ä¸­ã€‚æ¯å½“æ‚¨å¤„ç†åº”ç”¨ç¨‹åºæ—¶ï¼Œéƒ½å¿…é¡»ä¸ web ä¸Šçš„è¿™ä¸ªä¸­å¤®æœåŠ¡å™¨è¿›è¡Œé€šä¿¡ã€‚

å¦‚æœæˆ‘ä»¬è¦åœ¨ web ä¸Šæ„å»ºæŠ•ç¥¨åº”ç”¨ç¨‹åºï¼Œæˆ‘ä»¬ä¼šé‡åˆ°ä¸€äº›é—®é¢˜:

1.  æ•°æ®åº“ä¸­çš„æ•°æ®å¯èƒ½ä¼šè¢«æ›´æ”¹:å®ƒå¯èƒ½ä¼šè¢«å¤šæ¬¡è®¡æ•°ï¼Œæˆ–è€…è¢«å®Œå…¨åˆ é™¤ã€‚
2.  web æœåŠ¡å™¨ä¸Šçš„æºä»£ç ä¹Ÿå¯ä»¥éšæ—¶æ›´æ”¹ã€‚

æˆ‘ä»¬ä¸æƒ³åœ¨ç½‘ç»œä¸Šæ„å»ºæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºã€‚æˆ‘ä»¬å¸Œæœ›å°†å®ƒå»ºç«‹åœ¨åŒºå—é“¾ä¸Šï¼Œä»»ä½•è¿æ¥åˆ°ç½‘ç»œçš„äººéƒ½å¯ä»¥å‚åŠ é€‰ä¸¾ã€‚æˆ‘ä»¬å¸Œæœ›ç¡®ä¿ä»–ä»¬çš„é€‰ç¥¨è¢«è®¡ç®—åœ¨å†…ï¼Œè€Œä¸”åªè¢«è®¡ç®—ä¸€æ¬¡ã€‚è®©æˆ‘ä»¬æ¥çœ‹çœ‹å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚

ä¸ç½‘ç»œã€ä¸­å¤®æœåŠ¡å™¨å’Œæ•°æ®åº“ä¸åŒï¼Œ*åŒºå—é“¾é›†ç½‘ç»œå’Œæ•°æ®åº“äºä¸€èº«*ã€‚åŒºå—é“¾æ˜¯è®¡ç®—æœºçš„å¯¹ç­‰ç½‘ç»œï¼Œç§°ä¸ºèŠ‚ç‚¹ï¼Œå…±äº«ç½‘ç»œä¸­çš„æ‰€æœ‰æ•°æ®å’Œä»£ç ã€‚å› æ­¤ï¼Œå¦‚æœä½ æ˜¯ä¸€å°è¿æ¥åˆ°åŒºå—é“¾çš„è®¾å¤‡ï¼Œä½ å°±æ˜¯ç½‘ç»œä¸­çš„ä¸€ä¸ªèŠ‚ç‚¹ï¼Œä½ ä¸ç½‘ç»œä¸­çš„æ‰€æœ‰å…¶ä»–è®¡ç®—æœºèŠ‚ç‚¹è¿›è¡Œé€šä¿¡ã€‚æ‚¨ç°åœ¨æ‹¥æœ‰äº†åŒºå—é“¾ä¸Šæ‰€æœ‰æ•°æ®å’Œä»£ç çš„å‰¯æœ¬ã€‚ä¸å†æœ‰ä¸­å¤®æœåŠ¡å™¨äº†ã€‚åªæ˜¯ä¸€å †åœ¨åŒä¸€ä¸ªç½‘ç»œä¸Šäº’ç›¸äº¤æµçš„è®¡ç®—æœºã€‚

![Ethereum Blockchain Nodes Diagram](img/2f7b238f5f7ab1412ed5130234b997a8.png)

ä¸é›†ä¸­å¼æ•°æ®åº“ä¸åŒï¼ŒåŒºå—é“¾ä¸­è·¨èŠ‚ç‚¹å…±äº«çš„æ‰€æœ‰äº¤æ˜“æ•°æ®éƒ½åŒ…å«åœ¨è¢«ç§°ä¸ºå—çš„*è®°å½•æŸä¸­ï¼Œè¿™äº›è®°å½•è¢«**é“¾æ¥åœ¨ä¸€èµ·*** ä»¥åˆ›å»ºå…¬å…±åˆ†ç±»è´¦ã€‚è¯¥å…¬å…±åˆ†ç±»è´¦ä»£è¡¨åŒºå—é“¾ä¸­çš„æ‰€æœ‰æ•°æ®ã€‚å…¬å…±åˆ†ç±»å¸ä¸­çš„æ‰€æœ‰æ•°æ®éƒ½é€šè¿‡åŠ å¯†å“ˆå¸Œè¿›è¡Œä¿æŠ¤ï¼Œå¹¶é€šè¿‡ä¸€è‡´ç®—æ³•è¿›è¡ŒéªŒè¯ã€‚ç½‘ç»œä¸Šçš„èŠ‚ç‚¹å‚ä¸è¿›æ¥ï¼Œä»¥ç¡®ä¿åˆ†å¸ƒåœ¨ç½‘ç»œä¸Šçš„æ‰€æœ‰æ•°æ®å‰¯æœ¬éƒ½æ˜¯ç›¸åŒçš„ã€‚è¿™æ˜¯æˆ‘ä»¬åœ¨åŒºå—é“¾ä¸Šæ„å»ºæŠ•ç¥¨åº”ç”¨ç¨‹åºçš„ä¸€ä¸ªéå¸¸é‡è¦çš„åŸå› ï¼Œå› ä¸ºæˆ‘ä»¬å¸Œæœ›ç¡®ä¿æˆ‘ä»¬çš„æŠ•ç¥¨è¢«è®¡ç®—åœ¨å†…ï¼Œå¹¶ä¸”ä¸ä¼šæ”¹å˜ã€‚

æˆ‘ä»¬åº”ç”¨ç¨‹åºçš„ç”¨æˆ·åœ¨åŒºå—é“¾ä¸ŠæŠ•ç¥¨ä¼šæ˜¯ä»€ä¹ˆæ ·å­ï¼Ÿé¦–å…ˆï¼Œç”¨æˆ·éœ€è¦ä¸€ä¸ªè´¦æˆ·ï¼Œè¿™ä¸ªè´¦æˆ·çš„é’±åŒ…åœ°å€è¦æœ‰ä»¥å¤ªï¼Œä»¥å¤ªåŠçš„åŠ å¯†è´§å¸ã€‚ä¸€æ—¦ä»–ä»¬è¿æ¥åˆ°ç½‘ç»œï¼Œä»–ä»¬æŠ•ä¸‹è‡ªå·±çš„ä¸€ç¥¨ï¼Œå¹¶æ”¯ä»˜å°‘é‡äº¤æ˜“è´¹ï¼Œä»¥å°†æ­¤äº¤æ˜“å†™å…¥åŒºå—é“¾ã€‚è¿™ä¸ªäº¤æ˜“è´¹å«â€œæ°”â€ã€‚æ¯å½“æŠ•ç¥¨æ—¶ï¼Œç½‘ç»œä¸Šçš„ä¸€äº›ç§°ä¸ºçŸ¿å·¥çš„èŠ‚ç‚¹ç«äº‰å®Œæˆè¿™ä¸€äº‹åŠ¡ã€‚å®Œæˆè¿™é¡¹äº¤æ˜“çš„çŸ¿å·¥å°†è·å¾—æˆ‘ä»¬æŠ•ç¥¨è´­ä¹°çš„ä¹™é†šã€‚

æ¦‚æ‹¬åœ°è¯´ï¼Œå½“æˆ‘æŠ•ç¥¨æ—¶ï¼Œæˆ‘æ”¯ä»˜æ±½æ²¹ä»·æ ¼æ¥æŠ•ç¥¨ï¼Œå½“æˆ‘çš„æŠ•ç¥¨è¢«è®°å½•ä¸‹æ¥æ—¶ï¼Œç½‘ç»œä¸Šçš„ä¸€å°è®¡ç®—æœºä¼šæ”¯ä»˜æˆ‘çš„ä»¥å¤ªè´¹ã€‚åè¿‡æ¥ï¼Œæˆ‘ç›¸ä¿¡æˆ‘çš„æŠ•ç¥¨ä¼šè¢«æ°¸è¿œå‡†ç¡®åœ°è®°å½•ä¸‹æ¥ã€‚

å› æ­¤ï¼ŒåŒæ ·é‡è¦çš„æ˜¯è¦æ³¨æ„ï¼Œåœ¨åŒºå—é“¾ä¸ŠæŠ•ç¥¨éœ€è¦æ—¶é—´ï¼Œä½†ä»…ä»…çœ‹åˆ°å€™é€‰äººåå•å¹¶ä¸éœ€è¦æ—¶é—´ã€‚è¿™æ˜¯å› ä¸ºä»åŒºå—é“¾è¯»å–æ•°æ®æ˜¯å…è´¹çš„ï¼Œä½†å†™å…¥æ•°æ®å´ä¸æ˜¯ã€‚

## ä»€ä¹ˆæ˜¯æ™ºèƒ½åˆåŒï¼Ÿ

è¿™å°±æ˜¯æŠ•ç¥¨è¿‡ç¨‹çš„å·¥ä½œæ–¹å¼ï¼Œä½†æ˜¯æˆ‘ä»¬å®é™…ä¸Šå¦‚ä½•ç¼–å†™æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºå‘¢ï¼Ÿå—¯ï¼Œä»¥å¤ªåŠåŒºå—é“¾å…è®¸æˆ‘ä»¬ç”¨åŒºå—é“¾ä¸Šçš„ä»¥å¤ªåŠè™šæ‹Ÿæœº(EVM)é€šè¿‡ä¸€ç§å«åšæ™ºèƒ½åˆçº¦çš„ä¸œè¥¿æ¥æ‰§è¡Œä»£ç ã€‚

æ™ºèƒ½åˆçº¦æ˜¯æˆ‘ä»¬åº”ç”¨ç¨‹åºçš„æ‰€æœ‰ä¸šåŠ¡é€»è¾‘æ‰€åœ¨ã€‚è¿™æ˜¯æˆ‘ä»¬å®é™…ç¼–å†™åº”ç”¨ç¨‹åºåˆ†æ•£éƒ¨åˆ†çš„åœ°æ–¹ã€‚æ™ºèƒ½åˆçº¦è´Ÿè´£å‘åŒºå—é“¾è¯»å†™æ•°æ®ï¼Œä»¥åŠæ‰§è¡Œä¸šåŠ¡é€»è¾‘ã€‚æ™ºèƒ½è”ç³»äººæ˜¯ç”¨ä¸€ç§å«åš [Solidity](https://solidity.readthedocs.io/en/v0.4.21/) çš„ç¼–ç¨‹è¯­è¨€ç¼–å†™çš„ï¼Œçœ‹èµ·æ¥å¾ˆåƒ Javascriptã€‚å®ƒæ˜¯ä¸€ç§æˆç†Ÿçš„ç¼–ç¨‹è¯­è¨€ï¼Œå…è®¸æˆ‘ä»¬åšè®¸å¤š Javascript èƒ½åšçš„ç›¸åŒç±»å‹çš„äº‹æƒ…ï¼Œä½†ç”±äºå®ƒçš„ç”¨ä¾‹ï¼Œå®ƒçš„è¡Œä¸ºæœ‰ç‚¹ä¸åŒï¼Œæ­£å¦‚æˆ‘ä»¬å°†åœ¨æœ¬æ•™ç¨‹ä¸­çœ‹åˆ°çš„ã€‚

åŒºå—é“¾ä¸Šçš„æ™ºèƒ½åˆçº¦çš„åŠŸèƒ½éå¸¸ç±»ä¼¼äºç½‘ç»œä¸Šçš„å¾®æœåŠ¡ã€‚å¦‚æœå…¬å…±åˆ†ç±»å¸ä»£è¡¨åŒºå—é“¾çš„æ•°æ®åº“å±‚ï¼Œé‚£ä¹ˆæ™ºèƒ½åˆåŒå°±æ˜¯å¤„ç†è¯¥æ•°æ®çš„æ‰€æœ‰ä¸šåŠ¡é€»è¾‘æ‰€åœ¨çš„åœ°æ–¹ã€‚

æ­¤å¤–ï¼Œå®ƒä»¬è¢«ç§°ä¸ºæ™ºèƒ½åˆåŒï¼Œå› ä¸ºå®ƒä»¬ä»£è¡¨ä¸€ä¸ªå¥‘çº¦æˆ–åè®®ã€‚åœ¨æˆ‘ä»¬çš„æŠ•ç¥¨ dApp çš„æƒ…å†µä¸‹ï¼Œè¿™æ˜¯ä¸€ä¸ªåè®®ï¼Œæˆ‘çš„ç¥¨å°†è¢«è®¡ç®—åœ¨å†…ï¼Œå…¶ä»–çš„ç¥¨åªè¢«è®¡ç®—ä¸€æ¬¡ï¼Œæ‹¥æœ‰æœ€å¤šé€‰ç¥¨çš„å€™é€‰äººå°†èµ¢å¾—é€‰ä¸¾ã€‚

ç°åœ¨è®©æˆ‘ä»¬å¿«é€Ÿçœ‹ä¸€ä¸‹æˆ‘ä»¬æ­£åœ¨æ„å»ºçš„ dApp çš„ç»“æ„ã€‚

![dApp Diagram](img/127a9de1ed2ec7fa39c31f46e5f7b500.png)

æˆ‘ä»¬å°†æ‹¥æœ‰ä¸€ä¸ªç”¨ HTMLã€CSS å’Œ Javascript ç¼–å†™çš„ä¼ ç»Ÿå‰ç«¯å®¢æˆ·ç«¯ã€‚è¿™ä¸ªå®¢æˆ·ç«¯å°†è¿æ¥åˆ°æˆ‘ä»¬å°†è¦å®‰è£…çš„æœ¬åœ°ä»¥å¤ªåŠåŒºå—é“¾ï¼Œè€Œä¸æ˜¯ä¸åç«¯æœåŠ¡å™¨å¯¹è¯ã€‚æˆ‘ä»¬å°†ä½¿ç”¨ Solidity ç¼–ç¨‹è¯­è¨€åœ¨é€‰ä¸¾æ™ºèƒ½å¥‘çº¦ä¸­ç¼–å†™å…³äº dApp çš„æ‰€æœ‰ä¸šåŠ¡é€»è¾‘ã€‚æˆ‘ä»¬å°†æŠŠè¿™ä¸ªæ™ºèƒ½åˆçº¦éƒ¨ç½²åˆ°æˆ‘ä»¬çš„æœ¬åœ°ä»¥å¤ªç½‘åŒºå—é“¾ï¼Œå¹¶å…è®¸å¸æˆ·å¼€å§‹æŠ•ç¥¨ã€‚

ç°åœ¨æˆ‘ä»¬å·²ç»äº†è§£äº†ä»€ä¹ˆæ˜¯åŒºå—é“¾ä»¥åŠå®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚æˆ‘ä»¬å·²ç»çœ‹åˆ°äº†ä¸ºä»€ä¹ˆæˆ‘ä»¬è¦åœ¨åŒºå—é“¾è€Œä¸æ˜¯ç°åœ¨çš„ç½‘ç»œä¸Šå»ºç«‹æˆ‘ä»¬çš„æŠ•ç¥¨ dAppã€‚æˆ‘ä»¬å·²ç»çœ‹åˆ°ï¼Œæˆ‘ä»¬å¸Œæœ›é€šè¿‡ç¼–å†™ä¸€ä¸ªå°†éƒ¨ç½²åˆ°ä»¥å¤ªåŠåŒºå—é“¾çš„æ™ºèƒ½åˆçº¦æ¥ç¼–å†™æˆ‘ä»¬çš„ dAppã€‚ç°åœ¨è®©æˆ‘ä»¬å¼€å§‹ç¼–ç¨‹å§ï¼

## æˆ‘ä»¬å°†ä¼šå»ºé€ ä»€ä¹ˆ

è¿™æ˜¯æˆ‘ä»¬å°†è¦å»ºç«‹çš„æŠ•ç¥¨ dApp çš„æ¼”ç¤ºã€‚

![dApp Demo](img/4ac4599a7f0aa3a79346bf05fa8a5a13.png)

æˆ‘ä»¬å°†æ„å»ºä¸€ä¸ªå®¢æˆ·ç«¯åº”ç”¨ç¨‹åºï¼Œå®ƒå°†åœ¨åŒºå—é“¾ä¸Šä¸æˆ‘ä»¬çš„æ™ºèƒ½åˆçº¦å¯¹è¯ã€‚è¿™ä¸ªå®¢æˆ·ç«¯åº”ç”¨ç¨‹åºå°†æœ‰ä¸€ä¸ªå€™é€‰äººè¡¨ï¼Œåˆ—å‡ºæ¯ä¸ªå€™é€‰äººçš„ idã€å§“åå’Œç¥¨æ•°ã€‚å®ƒå°†æœ‰ä¸€ä¸ªè¡¨æ ¼ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºæˆ‘ä»¬æƒ³è¦çš„å€™é€‰äººæŠ•ç¥¨ã€‚å®ƒè¿˜åœ¨â€œæ‚¨çš„å¸æˆ·â€ä¸‹æ˜¾ç¤ºäº†æˆ‘ä»¬è¿æ¥åˆ°åŒºå—é“¾çš„å¸æˆ·ã€‚

## å®‰è£…ä¾èµ–é¡¹

è¿™éƒ¨åˆ†æ•™ç¨‹çš„è§†é¢‘ç‰‡æ®µä» [8:53](https://www.youtube.com/watch?v=3681ZYbDSSk&feature=youtu.be&t=8m53s) å¼€å§‹ã€‚

ä¸ºäº†æ„å»ºæˆ‘ä»¬çš„ dAppï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦ä¸€äº›ä¾èµ–é¡¹ã€‚

### èŠ‚ç‚¹ç¨‹åºåŒ…ç®¡ç†å™¨(NPM)

æˆ‘ä»¬éœ€è¦çš„ç¬¬ä¸€ä¸ªä¾èµ–é¡¹æ˜¯ Node.js é™„å¸¦çš„[èŠ‚ç‚¹åŒ…ç®¡ç†å™¨](https://nodejs.org/en/)æˆ– NPMã€‚æ‚¨å¯ä»¥æŸ¥çœ‹æ˜¯å¦å·²ç»å®‰è£…äº† Nodeï¼Œæ–¹æ³•æ˜¯åœ¨æ‚¨çš„ç»ˆç«¯ä¸Šé”®å…¥:

```js
$ node -v
```

### å—èŒæ¡†æ¶

ä¸‹ä¸€ä¸ªä¾èµ–é¡¹æ˜¯ [Truffle æ¡†æ¶](http://truffleframework.com/)ï¼Œå®ƒå…è®¸æˆ‘ä»¬åœ¨ä»¥å¤ªåŠåŒºå—é“¾ä¸Šæ„å»ºå»ä¸­å¿ƒåŒ–çš„åº”ç”¨ç¨‹åºã€‚å®ƒæä¾›äº†ä¸€å¥—å·¥å…·ï¼Œå…è®¸æˆ‘ä»¬ç”¨ Solidity ç¼–ç¨‹è¯­è¨€ç¼–å†™æ™ºèƒ½è”ç³»äººã€‚å®ƒè¿˜ä½¿æˆ‘ä»¬èƒ½å¤Ÿæµ‹è¯•æˆ‘ä»¬çš„æ™ºèƒ½åˆåŒï¼Œå¹¶å°†å…¶éƒ¨ç½²åˆ°åŒºå—é“¾ã€‚å®ƒè¿˜ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªå¼€å‘å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºçš„åœ°æ–¹ã€‚

æ‚¨å¯ä»¥åœ¨å‘½ä»¤è¡Œä¸­å®‰è£…å¸¦æœ‰ NPM çš„æ¾éœ²ï¼Œå¦‚ä¸‹æ‰€ç¤º:

```js
$ npm install -g truffle
```

### åŠ çº³åˆ‡

ä¸‹ä¸€ä¸ªä¾èµ–é¡¹æ˜¯ [Ganache](http://truffleframework.com/ganache) ï¼Œä¸€ä¸ªæœ¬åœ°å†…å­˜ä¸­çš„åŒºå—é“¾ã€‚ä½ å¯ä»¥é€šè¿‡[ä»æ¾éœ²æ¡†æ¶ç½‘ç«™](http://truffleframework.com/ganache)ä¸‹è½½å®‰è£… Ganacheã€‚å®ƒä¼šç»™æˆ‘ä»¬ 10 ä¸ªå¤–éƒ¨å¸æˆ·çš„åœ°å€åœ¨æˆ‘ä»¬å½“åœ°çš„ä»¥å¤ªåŠåŒºå—é“¾ã€‚æ¯ä¸ªè´¦æˆ·éƒ½é¢„è£…äº† 100 ä¸ªå‡ä¹™é†šã€‚

### Metamask

ä¸‹ä¸€ä¸ªä¾èµ–é¡¹æ˜¯ Google Chrome çš„[å…ƒæ©ç æ‰©å±•ã€‚ä¸ºäº†ä½¿ç”¨åŒºå—é“¾ï¼Œæˆ‘ä»¬å¿…é¡»è¿æ¥åˆ°å®ƒ(è®°ä½ï¼Œæˆ‘è¯´è¿‡åŒºå—é“¾**æ˜¯**ç½‘ç»œ)ã€‚ä¸ºäº†ä½¿ç”¨ä»¥å¤ªåŠåŒºå—é“¾ï¼Œæˆ‘ä»¬å¿…é¡»å®‰è£…ä¸€ä¸ªç‰¹æ®Šçš„æµè§ˆå™¨æ‰©å±•ã€‚è¿™å°±æ˜¯ metamask çš„ç”¨æ­¦ä¹‹åœ°ã€‚æˆ‘ä»¬å°†èƒ½å¤Ÿç”¨æˆ‘ä»¬çš„ä¸ªäººè´¦æˆ·è¿æ¥åˆ°æˆ‘ä»¬å½“åœ°çš„ä»¥å¤ªåŠåŒºå—é“¾ï¼Œå¹¶ä¸æˆ‘ä»¬çš„æ™ºèƒ½åˆçº¦è¿›è¡Œäº¤äº’ã€‚](https://chrome.google.com/webstore/detail/metamask/nkbihfbeogaeaoehlefnkodbefgpgknn?hl=en)

åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ Metamask chrome æ‰©å±•ï¼Œæ‰€ä»¥å¦‚æœä½ è¿˜æ²¡æœ‰è°·æ­Œ chrome æµè§ˆå™¨ï¼Œä½ ä¹Ÿéœ€è¦å®‰è£…å®ƒã€‚è¦å®‰è£… Metamaskï¼Œè¯·åœ¨ Google Chrome ç½‘ç»œå•†åº—ä¸­æœç´¢ Metamask Chrome æ’ä»¶ã€‚ä¸€æ—¦ä½ å®‰è£…äº†å®ƒï¼Œç¡®ä¿å®ƒåœ¨ä½ çš„æ‰©å±•åˆ—è¡¨ä¸­è¢«é€‰ä¸­ã€‚å®‰è£… Chrome æµè§ˆå™¨åï¼Œä½ ä¼šåœ¨æµè§ˆå™¨çš„å³ä¸Šè§’çœ‹åˆ°ç‹ç‹¸å›¾æ ‡ã€‚å¦‚æœé‡åˆ°å›°éš¾ï¼Œè¯·å‚è€ƒè§†é¢‘æ¼”ç¤ºï¼

### è¯­æ³•çªå‡ºæ˜¾ç¤º

ä¾èµ–é¡¹æ˜¯å¯é€‰çš„ï¼Œä½†æ˜¯æ¨èä½¿ç”¨ã€‚æˆ‘å»ºè®®ä¸º [Solidity](https://solidity.readthedocs.io/en/v0.4.21/) ç¼–ç¨‹è¯­è¨€å®‰è£…è¯­æ³•é«˜äº®ã€‚å¤§å¤šæ•°æ–‡æœ¬ç¼–è¾‘å™¨å’Œ ide æ²¡æœ‰çªå‡ºæ˜¾ç¤ºè¯­æ³•çš„åŠŸèƒ½ï¼Œæ‰€ä»¥ä½ å¿…é¡»å®‰è£…ä¸€ä¸ªåŒ…æ¥æ”¯æŒå®ƒã€‚æˆ‘æ­£åœ¨ä½¿ç”¨[å´‡é«˜æ–‡æœ¬](https://www.sublimetext.com/)ï¼Œå¹¶ä¸”æˆ‘å·²ç»ä¸‹è½½äº†[â€œä»¥å¤ªåŠâ€è½¯ä»¶åŒ…](https://packagecontrol.io/packages/Ethereum)ï¼Œå®ƒæä¾›äº†å¾ˆå¥½çš„è¯­æ³•é«˜äº®æ˜¾ç¤ºä»¥ä¿è¯å¯é æ€§ã€‚

## çƒŸé›¾æµ‹è¯•-æ­¥éª¤ 1

è¿™éƒ¨åˆ†æ•™ç¨‹çš„è§†é¢‘ç‰‡æ®µä» [11:40](https://www.youtube.com/watch?v=3681ZYbDSSk&feature=youtu.be&t=11m40s) å¼€å§‹ã€‚ä½ å¯ä»¥åœ¨è¿™é‡Œä¸‹è½½è¿™éƒ¨åˆ†æ•™ç¨‹[çš„ä»£ç ã€‚å¦‚æœä½ å¡ä½äº†ï¼Œè¯·éšæ„ä½¿ç”¨è¿™äº›ä½œä¸ºå‚è€ƒç‚¹ï¼](https://github.com/dappuniversity/election/releases/tag/1-smoke-test)

ç°åœ¨æˆ‘ä»¬å·²ç»å®‰è£…äº†ä¾èµ–é¡¹ï¼Œè®©æˆ‘ä»¬å¼€å§‹æ„å»º dApp å§ï¼

é¦–å…ˆæ‰¾åˆ°ä½ [ä¸‹è½½ Ganache](#ganache) çš„åœ°æ–¹ï¼Œæ‰“å¼€ã€‚ç°åœ¨ï¼ŒGanache å·²ç»å¯åŠ¨ï¼Œæ‚¨æœ‰ä¸€ä¸ªæœ¬åœ°åŒºå—é“¾è¿è¡Œã€‚

![Opening Ganache Blockchain Client](img/031a877c925465bfa37ffcad2697d994.png)

Ganache ç»™äº†æˆ‘ä»¬ 10 ä¸ªé¢„è£…äº† 100 ä¸ªå‡ä»¥å¤ªçš„è´¦å·(è¿™ä¸ªåœ¨ä¸»ä»¥å¤ªç½‘ä¸Šä¸€æ–‡ä¸å€¼)ã€‚æ¯ä¸ªå¸æˆ·éƒ½æœ‰å”¯ä¸€çš„åœ°å€å’Œç§é’¥ã€‚åœ¨æˆ‘ä»¬çš„é€‰ä¸¾ä¸­ï¼Œæ¯ä¸ªå¸æˆ·åœ°å€å°†ä½œä¸ºæ¯ä¸ªé€‰æ°‘çš„å”¯ä¸€æ ‡è¯†ç¬¦ã€‚

ç°åœ¨ï¼Œè®©æˆ‘ä»¬åœ¨å‘½ä»¤è¡Œä¸­ä¸º dApp åˆ›å»ºä¸€ä¸ªé¡¹ç›®ç›®å½•ï¼Œå¦‚ä¸‹æ‰€ç¤º:

```js
$ mkdir election
$ cd election

```

ç°åœ¨æˆ‘ä»¬å·²ç»è¿›å…¥äº†æˆ‘ä»¬çš„é¡¹ç›®ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ä¸€ä¸ª[å—èŒç›’å­](http://truffleframework.com/boxes/)å¿«é€Ÿå¯åŠ¨å¹¶è¿è¡Œã€‚åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨[å® ç‰©åº—ç›’å­](http://truffleframework.com/boxes/pet-shop)ã€‚åœ¨æ‚¨çš„é¡¹ç›®ç›®å½•ä¸­ï¼Œä»å‘½ä»¤è¡Œå®‰è£… pet shop boxï¼Œå¦‚ä¸‹æ‰€ç¤º:

```js
$ truffle unbox pet-shop
```

è®©æˆ‘ä»¬çœ‹çœ‹å® ç‰©åº—ç›’å­ç»™äº†æˆ‘ä»¬ä»€ä¹ˆ:

![Project Directory](img/30e94c13b5b0f86001f3a61aeb095fee.png)*   **åˆåŒç›®å½•:**è¿™æ˜¯æ‰€æœ‰æ™ºèƒ½è”ç³»äººæ‰€åœ¨çš„ä½ç½®ã€‚æˆ‘ä»¬å·²ç»æœ‰äº†ä¸€ä»½ç§»æ°‘åˆåŒï¼Œå¤„ç†æˆ‘ä»¬åˆ°åŒºå—é“¾çš„ç§»æ°‘äº‹å®œã€‚*   **è¿ç§»ç›®å½•**:è¿™æ˜¯æ‰€æœ‰è¿ç§»æ–‡ä»¶æ‰€åœ¨çš„åœ°æ–¹ã€‚è¿™äº›è¿ç§»ç±»ä¼¼äºå…¶ä»–éœ€è¦è¿ç§»æ¥æ”¹å˜æ•°æ®åº“çŠ¶æ€çš„ web å¼€å‘æ¡†æ¶ã€‚æ¯å½“æˆ‘ä»¬åœ¨åŒºå—é“¾éƒ¨ç½²æ™ºèƒ½åˆçº¦æ—¶ï¼Œæˆ‘ä»¬éƒ½åœ¨æ›´æ–°åŒºå—é“¾çš„çŠ¶æ€ï¼Œå› æ­¤éœ€è¦è¿ç§»ã€‚*   **node_modules ç›®å½•:**è¿™æ˜¯æˆ‘ä»¬æ‰€æœ‰èŠ‚ç‚¹ä¾èµ–é¡¹çš„ä¸»ç›®å½•ã€‚*   src ç›®å½•:è¿™æ˜¯æˆ‘ä»¬å¼€å‘å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºçš„åœ°æ–¹ã€‚*   æµ‹è¯•ç›®å½•:è¿™æ˜¯æˆ‘ä»¬ä¸ºæ™ºèƒ½åˆçº¦ç¼–å†™æµ‹è¯•çš„åœ°æ–¹ã€‚*   **truffle.js æ–‡ä»¶:**è¿™æ˜¯æˆ‘ä»¬çš„ truffle é¡¹ç›®çš„ä¸»é…ç½®æ–‡ä»¶

ç°åœ¨è®©æˆ‘ä»¬å¼€å§‹ç¼–å†™æˆ‘ä»¬çš„æ™ºèƒ½åˆåŒå§ï¼è¿™ä¸ªæ™ºèƒ½åˆåŒå°†åŒ…å«æˆ‘ä»¬ dApp çš„æ‰€æœ‰ä¸šåŠ¡é€»è¾‘ã€‚å®ƒå°†è´Ÿè´£è¯»å–å’Œå†™å…¥ä»¥å¤ªåŠåŒºå—é“¾ã€‚å®ƒå°†å…è®¸æˆ‘ä»¬åˆ—å‡ºå°†å‚åŠ é€‰ä¸¾çš„å€™é€‰äººï¼Œå¹¶è·Ÿè¸ªæ‰€æœ‰çš„é€‰ç¥¨å’Œé€‰æ°‘ã€‚å®ƒè¿˜å°†ç®¡ç†é€‰ä¸¾çš„æ‰€æœ‰è§„åˆ™ï¼Œæ¯”å¦‚å¼ºåˆ¶å¸æˆ·åªèƒ½æŠ•ç¥¨ä¸€æ¬¡ã€‚ä»é¡¹ç›®çš„æ ¹ç›®å½•å¼€å§‹ï¼Œåœ¨ contracts ç›®å½•ä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„åˆåŒæ–‡ä»¶ï¼Œå¦‚ä¸‹æ‰€ç¤º:

```js
$ touch contracts/Election.sol
```

è®©æˆ‘ä»¬ä»åˆ›å»ºä¸€ä¸ªâ€œå†’çƒŸæµ‹è¯•â€å¼€å§‹ï¼Œå®ƒå°†ç¡®ä¿æˆ‘ä»¬å·²ç»æ­£ç¡®åœ°è®¾ç½®äº†æˆ‘ä»¬çš„é¡¹ç›®ï¼Œå¹¶ä¸”æˆ‘ä»¬å¯ä»¥æˆåŠŸåœ°å°†åˆåŒéƒ¨ç½²åˆ°åŒºå—é“¾ã€‚æ‰“å¼€æ–‡ä»¶ï¼Œä»ä»¥ä¸‹ä»£ç å¼€å§‹:

```js
pragma solidity 0.4.2;

contract Election {
    // Read/write candidate
    string public candidate;

    // Constructor
    function Election () public {
        candidate = "Candidate 1";
    }
}

```

æˆ‘æ¥è§£é‡Šä¸€ä¸‹è¿™æ®µä»£ç ã€‚æˆ‘ä»¬ä»ç”¨`pragma solidity`è¯­å¥å£°æ˜ solidity ç‰ˆæœ¬å¼€å§‹ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ç”¨â€œcontractâ€å…³é”®å­—å£°æ˜æ™ºèƒ½åˆçº¦ï¼Œåè·Ÿåˆçº¦åç§°ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å£°æ˜ä¸€ä¸ªçŠ¶æ€å˜é‡ï¼Œå®ƒå°†å­˜å‚¨å€™é€‰äººå§“åçš„å€¼ã€‚çŠ¶æ€å˜é‡å…è®¸æˆ‘ä»¬å°†æ•°æ®å†™å…¥åŒºå—é“¾ã€‚æˆ‘ä»¬å·²ç»å£°æ˜è¿™ä¸ªå˜é‡å°†æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå¹¶ä¸”æˆ‘ä»¬å·²ç»å°†å®ƒçš„å¯è§æ€§è®¾ç½®ä¸º`public`ã€‚å› ä¸ºå®ƒæ˜¯å…¬å…±çš„ï¼Œsolidity å°†å…è´¹ç»™æˆ‘ä»¬ä¸€ä¸ª getter å‡½æ•°ï¼Œå…è®¸æˆ‘ä»¬åœ¨å¥‘çº¦ä¹‹å¤–è®¿é—®è¿™ä¸ªå€¼ã€‚æˆ‘ä»¬å°†åœ¨ç¨åçš„æ§åˆ¶å°ä¸­çœ‹åˆ°è¿™ä¸€ç‚¹ï¼

ç„¶åï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œæ¯å½“æˆ‘ä»¬å°†æ™ºèƒ½åˆçº¦éƒ¨ç½²åˆ°åŒºå—é“¾æ—¶ï¼Œéƒ½ä¼šè°ƒç”¨è¿™ä¸ªå‡½æ•°ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å°†è®¾ç½®å€™é€‰çŠ¶æ€å˜é‡çš„å€¼ï¼Œè¯¥å˜é‡å°†åœ¨è¿ç§»æ—¶å­˜å‚¨åˆ°åŒºå—é“¾ä¸­ã€‚è¯·æ³¨æ„ï¼Œæ„é€ å‡½æ•°ä¸æ™ºèƒ½åå®šåŒåã€‚Solidity å°±æ˜¯è¿™æ ·çŸ¥é“å‡½æ•°æ˜¯æ„é€ å‡½æ•°çš„ã€‚

ç°åœ¨ï¼Œæˆ‘ä»¬å·²ç»ä¸ºæ™ºèƒ½åˆçº¦åˆ›å»ºäº†åŸºç¡€ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹æ˜¯å¦å¯ä»¥å°†å®ƒéƒ¨ç½²åˆ°åŒºå—é“¾ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬éœ€è¦åœ¨è¿ç§»ç›®å½•ä¸­åˆ›å»ºæ–°æ–‡ä»¶ã€‚ä»é¡¹ç›®æ ¹ç›®å½•ä¸­ï¼Œé€šè¿‡å‘½ä»¤è¡Œåˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶ï¼Œå¦‚ä¸‹æ‰€ç¤º:

```js
$ touch migrations/2_deploy_contracts.js
```

è¯·æ³¨æ„ï¼Œæˆ‘ä»¬ç”¨æ•°å­—ç»™è¿ç§»ç›®å½•ä¸­çš„æ‰€æœ‰æ–‡ä»¶ç¼–å·ï¼Œä»¥ä¾¿ Truffle çŸ¥é“ä»¥ä»€ä¹ˆé¡ºåºæ‰§è¡Œå®ƒä»¬ã€‚è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–°çš„è¿ç§»æ¥éƒ¨ç½²åˆåŒï¼Œå¦‚ä¸‹æ‰€ç¤º:

```js
var Election = artifacts.require("./Election.sol");

module.exports = function(deployer) {
  deployer.deploy(Election);
};

```

é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦æˆ‘ä»¬å·²ç»åˆ›å»ºçš„å¥‘çº¦ï¼Œå¹¶å°†å…¶åˆ†é…ç»™ä¸€ä¸ªåä¸ºâ€œElectionâ€çš„å˜é‡ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†å®ƒæ·»åŠ åˆ°å·²éƒ¨ç½²å¥‘çº¦çš„æ¸…å•ä¸­ï¼Œä»¥ç¡®ä¿å®ƒåœ¨æˆ‘ä»¬è¿è¡Œè¿ç§»æ—¶å¾—åˆ°éƒ¨ç½²ã€‚ç°åœ¨ï¼Œè®©æˆ‘ä»¬åƒè¿™æ ·ä»å‘½ä»¤è¡Œè¿è¡Œæˆ‘ä»¬çš„è¿ç§»:

```js
$ truffle migrate
```

ç°åœ¨æˆ‘ä»¬å·²ç»æˆåŠŸåœ°å°†æ™ºèƒ½åˆçº¦è¿ç§»åˆ°æœ¬åœ°ä»¥å¤ªåŠåŒºå—é“¾ï¼Œè®©æˆ‘ä»¬æ‰“å¼€æ§åˆ¶å°ä¸æ™ºèƒ½åˆçº¦è¿›è¡Œäº¤äº’ã€‚æ‚¨å¯ä»¥ä»å‘½ä»¤è¡Œæ‰“å¼€ truffle æ§åˆ¶å°ï¼Œå¦‚ä¸‹æ‰€ç¤º:

```js
$ truffle console
```

ç°åœ¨æˆ‘ä»¬å·²ç»è¿›å…¥äº†æ§åˆ¶å°ï¼Œè®©æˆ‘ä»¬è·å–ä¸€ä¸ªå·²éƒ¨ç½²çš„æ™ºèƒ½å¥‘çº¦çš„å®ä¾‹ï¼Œçœ‹çœ‹æ˜¯å¦å¯ä»¥ä»å¥‘çº¦ä¸­è¯»å–å€™é€‰äººçš„å§“åã€‚ä»æ§åˆ¶å°ä¸­ï¼Œè¿è¡Œä»¥ä¸‹ä»£ç :

```js
Election.deployed().then(function(instance) { app = instance })
```

è¿™é‡Œçš„`Election`æ˜¯æˆ‘ä»¬åœ¨è¿ç§»æ–‡ä»¶ä¸­åˆ›å»ºçš„å˜é‡çš„åç§°ã€‚æˆ‘ä»¬ç”¨`deployed()`å‡½æ•°æ£€ç´¢äº†ä¸€ä¸ªå·²éƒ¨ç½²çš„å¥‘çº¦å®ä¾‹ï¼Œå¹¶å°†å…¶åˆ†é…ç»™ promise å›è°ƒå‡½æ•°ä¸­çš„ä¸€ä¸ª`app`å˜é‡ã€‚èµ·åˆè¿™å¯èƒ½çœ‹èµ·æ¥æœ‰ç‚¹æ··ä¹±ï¼Œä½†ä½ å¯ä»¥å‚è€ƒ[21:50](https://www.youtube.com/watch?v=3681ZYbDSSk&feature=youtu.be&t=21m50s)è§†é¢‘ä¸­çš„æ§åˆ¶å°æ¼”ç¤ºä»¥è·å¾—è¿›ä¸€æ­¥çš„è§£é‡Šã€‚

ç°åœ¨æˆ‘ä»¬å¯ä»¥è¿™æ ·è¯»å–å€™é€‰å˜é‡çš„å€¼:

```js
app.candidate()
// => 'Candidate 1' 

```

æ­å–œä½ ï¼æ‚¨åˆšåˆšç¼–å†™äº†ç¬¬ä¸€ä¸ªæ™ºèƒ½åˆåŒï¼Œéƒ¨ç½²åˆ°åŒºå—é“¾ï¼Œå¹¶æ£€ç´¢äº†å…¶ä¸­çš„ä¸€äº›æ•°æ®ã€‚

## åˆ—å‡ºå€™é€‰äºº-æ­¥éª¤ 2

è¿™éƒ¨åˆ†æ•™ç¨‹çš„è§†é¢‘ç‰‡æ®µä» [27:11](https://www.youtube.com/watch?v=3681ZYbDSSk&feature=youtu.be&t=27m11s) å¼€å§‹ã€‚ä½ å¯ä»¥åœ¨è¿™é‡Œä¸‹è½½è¿™éƒ¨åˆ†æ•™ç¨‹[çš„ä»£ç ã€‚å¦‚æœä½ å¡ä½äº†ï¼Œè¯·éšæ„ä½¿ç”¨è¿™äº›ä½œä¸ºå‚è€ƒç‚¹ï¼](https://github.com/dappuniversity/election/releases/tag/2-list-candidates)

ç°åœ¨ä¸€åˆ‡éƒ½è®¾ç½®å¦¥å½“äº†ï¼Œè®©æˆ‘ä»¬ç»§ç»­é€šè¿‡åˆ—å‡ºå°†å‚åŠ é€‰ä¸¾çš„å€™é€‰äººæ¥å»ºç«‹èªæ˜çš„è”ç³»ã€‚æˆ‘ä»¬éœ€è¦ä¸€ç§æ–¹æ³•æ¥å­˜å‚¨å¤šä¸ªå€™é€‰é¡¹ï¼Œå¹¶å­˜å‚¨æ¯ä¸ªå€™é€‰é¡¹çš„å¤šä¸ªå±æ€§ã€‚æˆ‘ä»¬å¸Œæœ›è·Ÿè¸ªå€™é€‰äººçš„ idã€å§“åå’Œç¥¨æ•°ã€‚ä»¥ä¸‹æ˜¯æˆ‘ä»¬å¯¹å€™é€‰äººçš„å»ºæ¨¡æ–¹å¼:

```js
contract Election {
    // Model a Candidate
    struct Candidate {
        uint id;
        string name;
        uint voteCount;
    }

    // ...
}

```

æˆ‘ä»¬å·²ç»ç”¨[å®ä½“ç»“æ„](https://solidity.readthedocs.io/en/v0.4.21/structure-of-a-contract.html?highlight=struct#structure-struct-types)ä¸ºå€™é€‰äººå»ºæ¨¡ã€‚åšå›ºæ€§å…è®¸æˆ‘ä»¬åˆ›å»ºè‡ªå·±çš„ç»“æ„ç±»å‹ï¼Œå°±åƒæˆ‘ä»¬åœ¨è¿™é‡Œä¸ºæˆ‘ä»¬çš„å€™é€‰äººæ‰€åšçš„é‚£æ ·ã€‚æˆ‘ä»¬æŒ‡å®šè¯¥ç»“æ„å…·æœ‰æ— ç¬¦å·æ•´æ•°ç±»å‹çš„ idã€å­—ç¬¦ä¸²ç±»å‹çš„åç§°å’Œæ— ç¬¦å·æ•´æ•°ç±»å‹çš„ voteCountã€‚ç®€å•åœ°å£°æ˜è¿™ä¸ªç»“æ„å®é™…ä¸Šä¸ä¼šç»™æˆ‘ä»¬ä¸€ä¸ªå€™é€‰ã€‚åœ¨å°†å®ƒå†™å…¥å­˜å‚¨ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å°†å…¶å®ä¾‹åŒ–å¹¶å°†å…¶èµ‹ç»™ä¸€ä¸ªå˜é‡ã€‚

æ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦ä¸€ä¸ªå­˜æ”¾å€™é€‰äººçš„åœ°æ–¹ã€‚æˆ‘ä»¬éœ€è¦ä¸€ä¸ªåœ°æ–¹æ¥å­˜å‚¨æˆ‘ä»¬åˆšåˆšåˆ›å»ºçš„ä¸€ä¸ªç»“æ„ç±»å‹ã€‚æˆ‘ä»¬å¯ä»¥ç”¨[å®åº¦è´´å›¾æ¥åšåˆ°è¿™ä¸€ç‚¹ã€‚](https://solidity.readthedocs.io/en/v0.4.21/types.html?highlight=mapping#mappings)Solidity ä¸­çš„æ˜ å°„å°±åƒä¸€ä¸ªå…³è”æ•°ç»„æˆ–æ•£åˆ—ï¼Œå®ƒå…³è”é”®å€¼å¯¹ã€‚æˆ‘ä»¬å¯ä»¥åˆ›å»ºè¿™æ ·çš„æ˜ å°„:

```js
contract Election {
    // Model a Candidate
    struct Candidate {
        uint id;
        string name;
        uint voteCount;
    }

    // Read/write Candidates
    mapping(uint => Candidate) public candidates;

    // ...
}

```

åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ˜ å°„çš„é”®æ˜¯ä¸€ä¸ª[æ— ç¬¦å·æ•´æ•°](https://solidity.readthedocs.io/en/v0.4.21/abi-spec.html?highlight=unsigned%20integer)ï¼Œå€¼æ˜¯æˆ‘ä»¬åˆšåˆšå®šä¹‰çš„å€™é€‰ç»“æ„ç±»å‹ã€‚è¿™å®è´¨ä¸Šä¸ºæˆ‘ä»¬æä¾›äº†åŸºäº id çš„æ¯ä¸ªå€™é€‰äººçš„æŸ¥æ‰¾ã€‚å› ä¸ºè¿™ä¸ªæ˜ å°„è¢«åˆ†é…ç»™ä¸€ä¸ªçŠ¶æ€å˜é‡ï¼Œæ‰€ä»¥åªè¦æˆ‘ä»¬ç»™å®ƒåˆ†é…æ–°çš„é”®å€¼å¯¹ï¼Œæˆ‘ä»¬å°±ä¼šæŠŠæ•°æ®å†™å…¥åŒºå—é“¾ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†è¿™ä¸ªæ˜ å°„çš„ visibility è®¾ç½®ä¸º`public`ï¼Œä»¥ä¾¿è·å¾—ä¸€ä¸ª getter å‡½æ•°ï¼Œå°±åƒæˆ‘ä»¬åœ¨ smoke æµ‹è¯•ä¸­å¯¹å€™é€‰äººå§“åæ‰€åšçš„é‚£æ ·ã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨å¦‚ä¸‹è®¡æ•°å™¨ç¼“å­˜çŠ¶æ€å˜é‡æ¥è·Ÿè¸ªé€‰ä¸¾ä¸­æœ‰å¤šå°‘å€™é€‰äºº:

```js
contract Election {
    // Model a Candidate
    struct Candidate {
        uint id;
        string name;
        uint voteCount;
    }

    // Read/write Candidates
    mapping(uint => Candidate) public candidates;

    // Store Candidates Count
    uint public candidatesCount;

    // ...
}

```

åœ¨ Solidity ä¸­ï¼Œæ²¡æœ‰åŠæ³•ç¡®å®šæ˜ å°„çš„å¤§å°ï¼Œä¹Ÿæ²¡æœ‰åŠæ³•è¿­ä»£å®ƒã€‚è¿™æ˜¯å› ä¸ºæ˜ å°„ä¸­ä»»ä½•å°šæœªèµ‹å€¼çš„é”®éƒ½å°†è¿”å›é»˜è®¤å€¼(åœ¨æœ¬ä¾‹ä¸­ä¸ºç©º)ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬åœ¨è¿™æ¬¡é€‰ä¸¾ä¸­åªæœ‰ 2 åå€™é€‰äººï¼Œå¹¶ä¸”æˆ‘ä»¬è¯•å›¾æŸ¥æ‰¾å€™é€‰äºº#99ï¼Œé‚£ä¹ˆæ˜ å°„å°†è¿”å›ä¸€ä¸ªç©ºçš„å€™é€‰äººç»“æ„ã€‚è¿™ç§è¡Œä¸ºä½¿å¾—æˆ‘ä»¬æ— æ³•çŸ¥é“æœ‰å¤šå°‘å€™é€‰é¡¹å­˜åœ¨ï¼Œå› æ­¤æˆ‘ä»¬å¿…é¡»ä½¿ç”¨è®¡æ•°å™¨ç¼“å­˜ã€‚

æ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå‡½æ•°ï¼Œå°†å€™é€‰é¡¹æ·»åŠ åˆ°æˆ‘ä»¬å·²ç»åˆ›å»ºçš„æ˜ å°„ä¸­ï¼Œå¦‚ä¸‹æ‰€ç¤º:

```js
contract Election {
    // ...

    function addCandidate (string _name) private {
        candidatesCount ++;
        candidates[candidatesCount] = Candidate(candidatesCount, _name, 0);
    }
}

```

æˆ‘ä»¬å·²ç»å£°æ˜äº†å‡½æ•°`addCandidate`,å®ƒæ¥å—ä¸€ä¸ªå­—ç¬¦ä¸²ç±»å‹çš„å‚æ•°ï¼Œè¡¨ç¤ºå€™é€‰äººçš„å§“åã€‚åœ¨å‡½æ•°å†…éƒ¨ï¼Œæˆ‘ä»¬é€’å¢å€™é€‰è®¡æ•°å™¨ç¼“å­˜ï¼Œä»¥è¡¨ç¤ºå·²ç»æ·»åŠ äº†ä¸€ä¸ªæ–°çš„å€™é€‰ã€‚ç„¶åï¼Œæˆ‘ä»¬ç”¨ä¸€ä¸ªæ–°çš„å€™é€‰ç»“æ„æ›´æ–°æ˜ å°„ï¼Œä½¿ç”¨å½“å‰çš„å€™é€‰è®¡æ•°ä½œä¸ºé”®ã€‚æ­¤å€™é€‰ç»“æ„ç”¨å½“å‰å€™é€‰è®¡æ•°ä¸­çš„å€™é€‰ idã€å‡½æ•°å‚æ•°ä¸­çš„åç§°ä»¥åŠåˆå§‹æŠ•ç¥¨è®¡æ•°åˆå§‹åŒ–ä¸º 0ã€‚æ³¨æ„ï¼Œè¿™ä¸ªå‡½æ•°çš„å¯è§æ€§æ˜¯ç§æœ‰çš„ï¼Œå› ä¸ºæˆ‘ä»¬åªæƒ³åœ¨å¥‘çº¦å†…éƒ¨è°ƒç”¨å®ƒã€‚

ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨æ„é€ å‡½æ•°ä¸­è°ƒç”¨ä¸¤æ¬¡â€œaddCandidateâ€å‡½æ•°å‘é€‰ä¸¾ä¸­æ·»åŠ ä¸¤ä¸ªå€™é€‰äººï¼Œå¦‚ä¸‹æ‰€ç¤º:

```js
contract Election {
    // ...

    function Election () public {
        addCandidate("Candidate 1");
        addCandidate("Candidate 2");
    }

    // ...
}

```

å½“æˆ‘ä»¬å°†åˆåŒéƒ¨ç½²åˆ°åŒºå—é“¾ï¼Œå¹¶ç”¨ä¸¤ä¸ªå€™é€‰äººå¡«å……æˆ‘ä»¬çš„é€‰ä¸¾æ—¶ï¼Œå°†æ‰§è¡Œè¯¥è¿ç§»ã€‚æ­¤æ—¶ï¼Œæ‚¨çš„å®Œæ•´åˆåŒä»£ç åº”è¯¥å¦‚ä¸‹æ‰€ç¤º:

```js
pragma solidity ^0.4.2;

contract Election {
    // Model a Candidate
    struct Candidate {
        uint id;
        string name;
        uint voteCount;
    }

    // Read/write candidates
    mapping(uint => Candidate) public candidates;

    // Store Candidates Count
    uint public candidatesCount;

    function Election () public {
        addCandidate("Candidate 1");
        addCandidate("Candidate 2");
    }

    function addCandidate (string _name) private {
        candidatesCount ++;
        candidates[candidatesCount] = Candidate(candidatesCount, _name, 0);
    }

}

```

ç°åœ¨ï¼Œè®©æˆ‘ä»¬åƒè¿™æ ·è¿ç§»æˆ‘ä»¬çš„åˆåŒ:

```js
$ truffle migrate --reset
```

ç°åœ¨å°è¯•åœ¨æ§åˆ¶å°å†…ä¸å€™é€‰äººäº’åŠ¨ã€‚å½“æˆ‘åœ¨ 37:31 çš„è§†é¢‘ä¸­æ¼”ç¤ºæ—¶ï¼Œä½ å¯ä»¥è·Ÿç€æˆ‘ä¸€èµ·çœ‹ã€‚æˆ‘æŠŠè¿™ä¸ªç•™ç»™ä½ åšç»ƒä¹ ã€‚ğŸ˜€

ç°åœ¨è®©æˆ‘ä»¬ç¼–å†™ä¸€äº›æµ‹è¯•æ¥ç¡®ä¿æˆ‘ä»¬çš„æ™ºèƒ½å¥‘çº¦è¢«æ­£ç¡®åˆå§‹åŒ–ã€‚é¦–å…ˆï¼Œè®©æˆ‘è§£é‡Šä¸€ä¸‹ä¸ºä»€ä¹ˆåœ¨å¼€å‘æ™ºèƒ½åˆåŒæ—¶æµ‹è¯•å¦‚æ­¤é‡è¦ã€‚æˆ‘ä»¬å¸Œæœ›ç¡®ä¿åˆåŒæ²¡æœ‰ bugï¼ŒåŸå› å¦‚ä¸‹:

1.ä»¥å¤ªåŠåŒºå—é“¾ä¸Šçš„æ‰€æœ‰ä»£ç éƒ½æ˜¯ä¸å¯å˜çš„ï¼›å®ƒä¸èƒ½æ”¹å˜ã€‚å¦‚æœåˆåŒåŒ…å«ä»»ä½•é”™è¯¯ï¼Œæˆ‘ä»¬å¿…é¡»ç¦ç”¨å®ƒå¹¶éƒ¨ç½²ä¸€ä¸ªæ–°çš„å‰¯æœ¬ã€‚è¿™ä¸ªæ–°å‰¯æœ¬ä¸æ—§åˆåŒçš„çŠ¶æ€ä¸åŒï¼Œåœ°å€ä¹Ÿä¸åŒã€‚

2.éƒ¨ç½²å¥‘çº¦éœ€è¦è€—è´¹å¤§é‡èµ„æºï¼Œå› ä¸ºå®ƒä¼šåˆ›å»ºä¸€ä¸ªäº‹åŠ¡å¹¶å°†æ•°æ®å†™å…¥åŒºå—é“¾ã€‚è¿™éœ€è¦æ¶ˆè€—ä¹™é†šï¼Œè€Œæˆ‘ä»¬å¸Œæœ›å°½å¯èƒ½å‡å°‘ä¹™é†šçš„ç”¨é‡ã€‚

3.å¦‚æœå†™å…¥åŒºå—é“¾çš„ä»»ä½•å¥‘çº¦å‡½æ•°åŒ…å«é”™è¯¯ï¼Œè°ƒç”¨è¯¥å‡½æ•°çš„å¸æˆ·å¯èƒ½ä¼šæµªè´¹èµ„æºï¼Œå¹¶ä¸”å®ƒå¯èƒ½ä¸ä¼šæŒ‰ç…§é¢„æœŸçš„æ–¹å¼è¿è¡Œã€‚

### æµ‹è¯•

ç°åœ¨è®©æˆ‘ä»¬å†™ä¸€äº›æµ‹è¯•ã€‚ç¡®ä¿é¦–å…ˆè¿è¡Œ Ganacheã€‚ç„¶åï¼Œåœ¨å‘½ä»¤è¡Œä¸­ä»é¡¹ç›®çš„æ ¹ç›®å½•åˆ›å»ºä¸€ä¸ªæ–°çš„æµ‹è¯•æ–‡ä»¶ï¼Œå¦‚ä¸‹æ‰€ç¤º:

```js
$ touch test/election.js
```

æˆ‘ä»¬å°†åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­ç”¨ Javascript ç¼–å†™æ‰€æœ‰çš„æµ‹è¯•ï¼Œç”¨[Mocha æµ‹è¯•æ¡†æ¶](https://mochajs.org/)å’Œ[Chai æ–­è¨€åº“](http://www.chaijs.com/)ã€‚è¿™äº›éƒ½ä¸ Truffle æ¡†æ¶æ†ç»‘åœ¨ä¸€èµ·ã€‚æˆ‘ä»¬å°†ä½¿ç”¨ Javascript ç¼–å†™æ‰€æœ‰è¿™äº›æµ‹è¯•æ¥æ¨¡æ‹Ÿå®¢æˆ·ç«¯ä¸æ™ºèƒ½åˆçº¦çš„äº¤äº’ï¼Œå°±åƒæˆ‘ä»¬åœ¨æ§åˆ¶å°ä¸­æ‰€åšçš„ä¸€æ ·ã€‚ä»¥ä¸‹æ˜¯æµ‹è¯•çš„æ‰€æœ‰ä»£ç :

```js
var Election = artifacts.require("./Election.sol");

contract("Election", function(accounts) {
  var electionInstance;

  it("initializes with two candidates", function() {
    return Election.deployed().then(function(instance) {
      return instance.candidatesCount();
    }).then(function(count) {
      assert.equal(count, 2);
    });
  });

  it("it initializes the candidates with the correct values", function() {
    return Election.deployed().then(function(instance) {
      electionInstance = instance;
      return electionInstance.candidates(1);
    }).then(function(candidate) {
      assert.equal(candidate[0], 1, "contains the correct id");
      assert.equal(candidate[1], "Candidate 1", "contains the correct name");
      assert.equal(candidate[2], 0, "contains the correct votes count");
      return electionInstance.candidates(2);
    }).then(function(candidate) {
      assert.equal(candidate[0], 2, "contains the correct id");
      assert.equal(candidate[1], "Candidate 2", "contains the correct name");
      assert.equal(candidate[2], 0, "contains the correct votes count");
    });
  });
});

```

æˆ‘æ¥è§£é‡Šä¸€ä¸‹è¿™æ®µä»£ç ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦è¦æ±‚å¥‘çº¦å¹¶å°†å…¶èµ‹ç»™ä¸€ä¸ªå˜é‡ï¼Œå°±åƒæˆ‘ä»¬åœ¨è¿ç§»æ–‡ä»¶ä¸­æ‰€åšçš„é‚£æ ·ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è°ƒç”¨â€œå¥‘çº¦â€å‡½æ•°ï¼Œå¹¶åœ¨å›è°ƒå‡½æ•°ä¸­ç¼–å†™æˆ‘ä»¬æ‰€æœ‰çš„æµ‹è¯•ã€‚è¿™ä¸ªå›è°ƒå‡½æ•°æä¾›äº†ä¸€ä¸ªâ€œaccountsâ€å˜é‡ï¼Œä»£è¡¨æˆ‘ä»¬çš„åŒºå—é“¾ä¸Šçš„æ‰€æœ‰å¸æˆ·ï¼Œç”± Ganache æä¾›ã€‚

ç¬¬ä¸€ä¸ªæµ‹è¯•é€šè¿‡æ£€æŸ¥å€™é€‰äººè®¡æ•°æ˜¯å¦ç­‰äº 2 æ¥æ£€æŸ¥åˆåŒæ˜¯å¦ç”¨æ­£ç¡®çš„å€™é€‰äººæ•°é‡è¿›è¡Œäº†åˆå§‹åŒ–ã€‚

ä¸‹ä¸€ä¸ªæµ‹è¯•æ£€æŸ¥é€‰ä¸¾ä¸­æ¯ä¸ªå€™é€‰äººçš„å€¼ï¼Œç¡®ä¿æ¯ä¸ªå€™é€‰äººéƒ½æœ‰æ­£ç¡®çš„ idã€å§“åå’Œç¥¨æ•°ã€‚

ç°åœ¨è®©æˆ‘ä»¬ä»å‘½ä»¤è¡Œè¿è¡Œæµ‹è¯•ï¼Œå¦‚ä¸‹æ‰€ç¤º:

```js
$ truffle test
```

è€¶ï¼Œä»–ä»¬é€šè¿‡äº†ï¼ğŸ‰å¦‚æœä½ è¢«å¡ä½äº†ï¼Œä½ å¯ä»¥åœ¨æˆ‘å†™è¿™äº›æµ‹è¯•çš„è§†é¢‘ä¸­è·Ÿæˆ‘ä¸€èµ·åšè¿›ä¸€æ­¥çš„è§£é‡Šã€‚

### å®¢æˆ·ç«¯åº”ç”¨ç¨‹åº

ç°åœ¨ï¼Œè®©æˆ‘ä»¬å¼€å§‹æ„å»ºå°†ä¸æˆ‘ä»¬çš„æ™ºèƒ½åˆçº¦å¯¹è¯çš„å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºã€‚æˆ‘ä»¬å°†é€šè¿‡ä¿®æ”¹ä¸Šä¸€èŠ‚ä¸­å®‰è£…çš„ Truffle Pet Shop box é™„å¸¦çš„ HTML å’Œ Javascript æ–‡ä»¶æ¥å®ç°è¿™ä¸€ç‚¹ã€‚æˆ‘ä»¬å°†ä½¿ç”¨ç°æœ‰çš„ä»£ç å¼€å§‹ã€‚è®©æˆ‘ä»¬ä¹Ÿæ³¨æ„ä¸€ä¸‹æ¾éœ²å® ç‰©åº—ç›’å­é™„å¸¦çš„ä¸€äº›å…¶ä»–ä¸œè¥¿ï¼Œæ¯”å¦‚[å¼•å¯¼æ¡†æ¶](https://getbootstrap.com/)ï¼Œè¿™å°†ä½¿æˆ‘ä»¬åœ¨æœ¬æ•™ç¨‹ä¸­ä¸å¿…ç¼–å†™ä»»ä½• CSSã€‚æˆ‘ä»¬è¿˜å¾—åˆ°äº† [lite-server](https://www.npmjs.com/package/light-server) ï¼Œå®ƒå°†ä¸ºæˆ‘ä»¬çš„èµ„äº§æä¾›å¼€å‘æœåŠ¡ã€‚

æ‚¨ä¸å¿…æˆä¸ºå‰ç«¯ä¸“å®¶ï¼Œä¹Ÿå¯ä»¥å­¦ä¹ æœ¬æ•™ç¨‹çš„è¿™ä¸€éƒ¨åˆ†ã€‚æˆ‘æœ‰æ„ä¿æŒ HTML å’Œ Javascript ä»£ç éå¸¸ç®€å•ï¼Œæˆ‘ä»¬ä¸ä¼šèŠ±å¤ªå¤šæ—¶é—´åœ¨è¿™ä¸Šé¢ã€‚æˆ‘æƒ³ç»§ç»­ä¸“æ³¨äºå¼€å‘æˆ‘ä»¬ dApp çš„æ™ºèƒ½åˆåŒéƒ¨åˆ†ï¼

ç»§ç»­ç”¨ä»¥ä¸‹ä»£ç æ›¿æ¢â€œindex.htmlâ€æ–‡ä»¶çš„æ‰€æœ‰å†…å®¹:

```js
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Election Results</title>

    <!-- Bootstrap -->
    <link href="css/bootstrap.min.css" rel="stylesheet">
  </head>
  <body>
    <div class="container" style="width: 650px;">
      <div class="row">
        <div class="col-lg-12">
          <h1 class="text-center">Election Results</h1>
          <hr/>
          <br/>
          <div id="loader">
            <p class="text-center">Loading...</p>
          </div>
          <div id="content" style="display: none;">
            <table class="table">
              <thead>
                <tr>
                  <th scope="col">#</th>
                  <th scope="col">Name</th>
                  <th scope="col">Votes</th>
                </tr>
              </thead>
              <tbody id="candidatesResults">
              </tbody>
            </table>
            <hr/>
            <p id="accountAddress" class="text-center"></p>
          </div>
        </div>
      </div>
    </div>

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="js/bootstrap.min.js"></script>
    <script src="js/web3.min.js"></script>
    <script src="js/truffle-contract.js"></script>
    <script src="js/app.js"></script>
  </body>
</html>

```

æ¥ä¸‹æ¥ï¼Œç”¨ä»¥ä¸‹ä»£ç æ›¿æ¢â€œapp.jsâ€æ–‡ä»¶çš„æ‰€æœ‰å†…å®¹:

```js
App = {
  web3Provider: null,
  contracts: {},
  account: '0x0',

  init: function() {
    return App.initWeb3();
  },

  initWeb3: function() {
    if (typeof web3 !== 'undefined') {
      // If a web3 instance is already provided by Meta Mask.
      App.web3Provider = web3.currentProvider;
      web3 = new Web3(web3.currentProvider);
    } else {
      // Specify default instance if no web3 instance provided
      App.web3Provider = new Web3.providers.HttpProvider('http://localhost:7545');
      web3 = new Web3(App.web3Provider);
    }
    return App.initContract();
  },

  initContract: function() {
    $.getJSON("Election.json", function(election) {
      // Instantiate a new truffle contract from the artifact
      App.contracts.Election = TruffleContract(election);
      // Connect provider to interact with contract
      App.contracts.Election.setProvider(App.web3Provider);

      return App.render();
    });
  },

  render: function() {
    var electionInstance;
    var loader = $("#loader");
    var content = $("#content");

    loader.show();
    content.hide();

    // Load account data
    web3.eth.getCoinbase(function(err, account) {
      if (err === null) {
        App.account = account;
        $("#accountAddress").html("Your Account: " + account);
      }
    });

    // Load contract data
    App.contracts.Election.deployed().then(function(instance) {
      electionInstance = instance;
      return electionInstance.candidatesCount();
    }).then(function(candidatesCount) {
      var candidatesResults = $("#candidatesResults");
      candidatesResults.empty();

      for (var i = 1; i <= candidatesCount; i++) {
        electionInstance.candidates(i).then(function(candidate) {
          var id = candidate[0];
          var name = candidate[1];
          var voteCount = candidate[2];

          // Render candidate Result
          var candidateTemplate = "<tr><th>" + id + "</th><td>" + name + "</td><td>" + voteCount + "</td></tr>"
          candidatesResults.append(candidateTemplate);
        });
      }

      loader.hide();
      content.show();
    }).catch(function(error) {
      console.warn(error);
    });
  }
};

$(function() {
  $(window).load(function() {
    App.init();
  });
});

```

è®©æˆ‘ä»¬æ³¨æ„ä¸€ä¸‹è¿™æ®µä»£ç åšçš„ä¸€äº›äº‹æƒ…:

1.  **è®¾ç½® web3:** [web3.js](https://web3js.readthedocs.io/en/1.0/) æ˜¯ä¸€ä¸ª javascript åº“ï¼Œå…è®¸æˆ‘ä»¬çš„å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºä¸åŒºå—é“¾å¯¹è¯ã€‚æˆ‘ä»¬åœ¨â€œinitWeb3â€å‡½æ•°ä¸­é…ç½® web3ã€‚
2.  **åˆå§‹åŒ–å¥‘çº¦:**æˆ‘ä»¬åœ¨è¿™ä¸ªå‡½æ•°ä¸­è·å–æ™ºèƒ½å¥‘çº¦çš„å·²éƒ¨ç½²å®ä¾‹ï¼Œå¹¶åˆ†é…ä¸€äº›å€¼ï¼Œå…è®¸æˆ‘ä»¬ä¸å®ƒè¿›è¡Œäº¤äº’ã€‚
3.  **Render å‡½æ•°:**Render å‡½æ•°ä½¿ç”¨æ™ºèƒ½åˆçº¦ä¸­çš„æ•°æ®æ¥å¸ƒå±€é¡µé¢ä¸Šçš„æ‰€æœ‰å†…å®¹ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬åˆ—å‡ºæˆ‘ä»¬åœ¨æ™ºèƒ½åˆåŒä¸­åˆ›å»ºçš„å€™é€‰äººã€‚æˆ‘ä»¬é€šè¿‡éå†æ˜ å°„ä¸­çš„æ¯ä¸ªå€™é€‰é¡¹ï¼Œå¹¶å°†å…¶å‘ˆç°åˆ°è¡¨ä¸­æ¥å®ç°è¿™ä¸€ç‚¹ã€‚æˆ‘ä»¬è¿˜åœ¨è¿™ä¸ªå‡½æ•°ä¸­è·å–è¿æ¥åˆ°åŒºå—é“¾çš„å½“å‰å¸æˆ·ï¼Œå¹¶å°†å…¶æ˜¾ç¤ºåœ¨é¡µé¢ä¸Šã€‚

ä½ å¯ä»¥[åœ¨ 57:21](https://www.youtube.com/watch?v=3681ZYbDSSk&feature=youtu.be&t=57m21s) çš„è§†é¢‘é‡Œçœ‹æˆ‘æ›´æ·±å…¥çš„è§£é‡Šè¿™æ®µä»£ç ã€‚

ç°åœ¨è®©æˆ‘ä»¬åœ¨æµè§ˆå™¨ä¸­æŸ¥çœ‹å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºã€‚é¦–å…ˆï¼Œç¡®ä¿æ‚¨å·²ç»åƒè¿™æ ·è¿ç§»äº†åˆåŒ:

```js
$ truffle migrate --reset
```

æ¥ä¸‹æ¥ï¼Œä»å‘½ä»¤è¡Œå¯åŠ¨å¼€å‘æœåŠ¡å™¨ï¼Œå¦‚ä¸‹æ‰€ç¤º:

```js
$ npm run dev
```

è¿™åº”è¯¥ä¼šè‡ªåŠ¨æ‰“å¼€ä¸€ä¸ªåŒ…å«æ‚¨çš„å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºçš„æ–°æµè§ˆå™¨çª—å£ã€‚

![Election Loadig Screen](img/5247305000a49342ab9b92e0bcfdfd0a.png)

è¯·æ³¨æ„ï¼Œæ‚¨çš„åº”ç”¨ç¨‹åºæ˜¾ç¤ºâ€œæ­£åœ¨åŠ è½½...â€ã€‚é‚£æ˜¯å› ä¸ºæˆ‘ä»¬è¿˜æ²¡æœ‰ç™»å½•åˆ°åŒºå—é“¾ï¼ä¸ºäº†è¿æ¥åˆ°åŒºå—é“¾ï¼Œæˆ‘ä»¬éœ€è¦å°†å…¶ä¸­ä¸€ä¸ªå¸æˆ·ä» Ganache å¯¼å…¥ Metamaskã€‚ä½ å¯ä»¥[åœ¨ 1:09:05](https://youtu.be/3681ZYbDSSk?t=1h9m5s) çš„è§†é¢‘é‡Œçœ‹æˆ‘è®¾ç½® Metamaskã€‚

ä¸€æ—¦æ‚¨ä¸ Metamask å»ºç«‹äº†è¿æ¥ï¼Œæ‚¨åº”è¯¥ä¼šçœ‹åˆ°æ‰€æœ‰çš„åˆåŒå’Œå¸æˆ·æ•°æ®éƒ½å·²åŠ è½½ã€‚

![Election Table Screen](img/3a09732964ffd9760c8fbdc43f29cfcc.png)

## æŠ•ç¥¨-æ­¥éª¤ 3

æœ¬æ•™ç¨‹è¿™ä¸€éƒ¨åˆ†çš„è§†é¢‘ç‰‡æ®µä» [1:13:39](https://youtu.be/3681ZYbDSSk?t=1h13m39s) å¼€å§‹ã€‚ä½ å¯ä»¥åœ¨è¿™é‡Œä¸‹è½½è¿™éƒ¨åˆ†æ•™ç¨‹[çš„ä»£ç ã€‚å¦‚æœä½ å¡ä½äº†ï¼Œè¯·éšæ„ä½¿ç”¨è¿™äº›ä½œä¸ºå‚è€ƒç‚¹ï¼](https://github.com/dappuniversity/election/releases/tag/3-cast-votes)

ç°åœ¨è®©æˆ‘ä»¬æ·»åŠ åœ¨é€‰ä¸¾ä¸­æŠ•ç¥¨çš„èƒ½åŠ›ã€‚è®©æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªæ˜ å°„åˆ°æ™ºèƒ½åˆåŒçš„â€œé€‰æ°‘â€æ¥è·Ÿè¸ªåœ¨é€‰ä¸¾ä¸­æŠ•ç¥¨çš„å¸æˆ·ï¼Œå¦‚ä¸‹æ‰€ç¤º:

```js
contract Election {
    // ...

    // Store accounts that have voted
    mapping(address => bool) public voters;

    // ...
}

```

ç°åœ¨è®©æˆ‘ä»¬æ·»åŠ ä¸€ä¸ªâ€œæŠ•ç¥¨â€åŠŸèƒ½:

```js
contract Election {
    // ...

    // Store accounts that have voted
    mapping(address => bool) public voters;

    // ...

    function vote (uint _candidateId) public {
        // require that they haven't voted before
        require(!voters[msg.sender]);

        // require a valid candidate
        require(_candidateId > 0 && _candidateId <= candidatesCount);

        // record that voter has voted
        voters[msg.sender] = true;

        // update candidate vote Count
        candidates[_candidateId].voteCount ++;
    }
}

```

è¯¥å‡½æ•°çš„æ ¸å¿ƒåŠŸèƒ½æ˜¯é€šè¿‡ä»â€œcandidatesâ€æ˜ å°„ä¸­è¯»å–å€™é€‰ç»“æ„å¹¶ä½¿ç”¨é€’å¢è¿ç®—ç¬¦(++)å°†â€œvote countâ€å¢åŠ  1 æ¥å¢åŠ å€™é€‰äººçš„æŠ•ç¥¨æ•°ã€‚è®©æˆ‘ä»¬çœ‹çœ‹å®ƒçš„å…¶ä»–ä¸€äº›åŠŸèƒ½:

1.  å®ƒæ¥å—ä¸€ä¸ªå‚æ•°ã€‚è¿™æ˜¯ä¸€ä¸ªå¸¦æœ‰å€™é€‰äºº id çš„æ— ç¬¦å·æ•´æ•°ã€‚
2.  å®ƒçš„å¯è§æ€§æ˜¯å…¬å¼€çš„ï¼Œå› ä¸ºæˆ‘ä»¬å¸Œæœ›å¤–éƒ¨å¸æˆ·è°ƒç”¨å®ƒã€‚
3.  å®ƒå°†æŠ•ç¥¨çš„å¸æˆ·æ·»åŠ åˆ°æˆ‘ä»¬åˆšåˆšåˆ›å»ºçš„é€‰æ°‘æ˜ å°„ä¸­ã€‚è¿™å°†ä½¿æˆ‘ä»¬èƒ½å¤Ÿè·Ÿè¸ªé€‰æ°‘åœ¨é€‰ä¸¾ä¸­çš„æŠ•ç¥¨æƒ…å†µã€‚æˆ‘ä»¬ä½¿ç”¨ Solidity æä¾›çš„å…¨å±€å˜é‡â€œmsg.senderâ€æ¥è®¿é—®è°ƒç”¨è¿™ä¸ªå‡½æ•°çš„å¸æˆ·ã€‚
4.  å®ƒå®ç°äº† require è¯­å¥ï¼Œå¦‚æœä¸æ»¡è¶³æ¡ä»¶ï¼Œè¿™äº›è¯­å¥å°†åœæ­¢æ‰§è¡Œã€‚é¦–å…ˆè¦æ±‚æŠ•ç¥¨äººä»¥å‰æ²¡æœ‰æŠ•ç¥¨ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬ä»æ˜ å°„ä¸­è¯»å–å¸¦æœ‰â€œmsg.senderâ€çš„å¸æˆ·åœ°å€ã€‚å¦‚æœåœ¨çš„è¯ï¼Œè´¦æˆ·å·²ç»æŠ•äº†ã€‚æ¥ä¸‹æ¥ï¼Œå®ƒè¦æ±‚å€™é€‰äºº id æœ‰æ•ˆã€‚æ±‚èŒè€… id å¿…é¡»å¤§äºé›¶ä¸”å°äºæˆ–ç­‰äºæ±‚èŒè€…æ€»æ•°ã€‚

ç°åœ¨ï¼Œæ‚¨çš„å®Œæ•´åˆåŒä»£ç åº”è¯¥å¦‚ä¸‹æ‰€ç¤º:

```js
pragma solidity ^0.4.2;

contract Election {
    // Model a Candidate
    struct Candidate {
        uint id;
        string name;
        uint voteCount;
    }

    // Store accounts that have voted
    mapping(address => bool) public voters;
    // Read/write candidates
    mapping(uint => Candidate) public candidates;
    // Store Candidates Count
    uint public candidatesCount;

    function Election () public {
        addCandidate("Candidate 1");
        addCandidate("Candidate 2");
    }

    function addCandidate (string _name) private {
        candidatesCount ++;
        candidates[candidatesCount] = Candidate(candidatesCount, _name, 0);
    }

    function vote (uint _candidateId) public {
        // require that they haven't voted before
        require(!voters[msg.sender]);

        // require a valid candidate
        require(_candidateId > 0 && _candidateId <= candidatesCount);

        // record that voter has voted
        voters[msg.sender] = true;

        // update candidate vote Count
        candidates[_candidateId].voteCount ++;
    }
}

```

è¯·è§‚çœ‹æˆ‘åœ¨ 1:13:58 å¯¹æŠ•ç¥¨è¿›è¡Œçš„æ·±å…¥è§£é‡Šã€‚ä½ ä¹Ÿå¯ä»¥åœ¨ 1:20:38 åœ¨æ§åˆ¶å°çœ‹æˆ‘[æ¼”ç¤ºæŠ•ç¥¨ã€‚](https://youtu.be/3681ZYbDSSk?t=1h20m38s)

### æµ‹è¯•æŠ•ç¥¨åŠŸèƒ½

ç°åœ¨è®©æˆ‘ä»¬å‘â€œelection.jsâ€æµ‹è¯•æ–‡ä»¶æ·»åŠ ä¸€ä¸ªæµ‹è¯•:

```js
it("allows a voter to cast a vote", function() {
    return Election.deployed().then(function(instance) {
      electionInstance = instance;
      candidateId = 1;
      return electionInstance.vote(candidateId, { from: accounts[0] });
    }).then(function(receipt) {
      return electionInstance.voters(accounts[0]);
    }).then(function(voted) {
      assert(voted, "the voter was marked as voted");
      return electionInstance.candidates(candidateId);
    }).then(function(candidate) {
      var voteCount = candidate[2];
      assert.equal(voteCount, 1, "increments the candidate's vote count");
    })
  });

```

æˆ‘ä»¬æƒ³åœ¨è¿™é‡Œæµ‹è¯•ä¸¤ä»¶äº‹:

1.  æµ‹è¯•è¯¥å‡½æ•°æ˜¯å¦ä¼šå¢åŠ å€™é€‰äººçš„æŠ•ç¥¨æ•°ã€‚
2.  æµ‹è¯•æŠ•ç¥¨äººåœ¨æŠ•ç¥¨æ—¶æ˜¯å¦è¢«æ·»åŠ åˆ°æ˜ å°„ä¸­ã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºæˆ‘ä»¬çš„åŠŸèƒ½éœ€æ±‚ç¼–å†™ä¸€äº›æµ‹è¯•ã€‚è®©æˆ‘ä»¬ç¼–å†™ä¸€ä¸ªæµ‹è¯•æ¥ç¡®ä¿æˆ‘ä»¬çš„æŠ•ç¥¨å‡½æ•°ä¸ºåŒé‡æŠ•ç¥¨æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸:

```js
it("throws an exception for invalid candidates", function() {
    return Election.deployed().then(function(instance) {
      electionInstance = instance;
      return electionInstance.vote(99, { from: accounts[1] })
    }).then(assert.fail).catch(function(error) {
      assert(error.message.indexOf('revert') >= 0, "error message must contain revert");
      return electionInstance.candidates(1);
    }).then(function(candidate1) {
      var voteCount = candidate1[2];
      assert.equal(voteCount, 1, "candidate 1 did not receive any votes");
      return electionInstance.candidates(2);
    }).then(function(candidate2) {
      var voteCount = candidate2[2];
      assert.equal(voteCount, 0, "candidate 2 did not receive any votes");
    });
  });

```

æˆ‘ä»¬å¯ä»¥æ–­è¨€äº‹åŠ¡å¤±è´¥ï¼Œå¹¶è¿”å›ä¸€æ¡é”™è¯¯æ¶ˆæ¯ã€‚æˆ‘ä»¬å¯ä»¥æ·±å…¥ç ”ç©¶è¿™ä¸ªé”™è¯¯æ¶ˆæ¯ï¼Œä»¥ç¡®ä¿é”™è¯¯æ¶ˆæ¯åŒ…å«â€œrevertâ€å­å­—ç¬¦ä¸²ã€‚ç„¶åï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ç¡®ä¿å€™é€‰äººæ²¡æœ‰æ”¶åˆ°ä»»ä½•æŠ•ç¥¨æ¥ç¡®ä¿æˆ‘ä»¬çš„åˆåŒçŠ¶æ€æ²¡æœ‰æ”¹å˜ã€‚

ç°åœ¨è®©æˆ‘ä»¬ç¼–å†™ä¸€ä¸ªæµ‹è¯•æ¥ç¡®ä¿æˆ‘ä»¬é˜²æ­¢åŒé‡æŠ•ç¥¨:

```js
it("throws an exception for double voting", function() {
    return Election.deployed().then(function(instance) {
      electionInstance = instance;
      candidateId = 2;
      electionInstance.vote(candidateId, { from: accounts[1] });
      return electionInstance.candidates(candidateId);
    }).then(function(candidate) {
      var voteCount = candidate[2];
      assert.equal(voteCount, 1, "accepts first vote");
      // Try to vote again
      return electionInstance.vote(candidateId, { from: accounts[1] });
    }).then(assert.fail).catch(function(error) {
      assert(error.message.indexOf('revert') >= 0, "error message must contain revert");
      return electionInstance.candidates(1);
    }).then(function(candidate1) {
      var voteCount = candidate1[2];
      assert.equal(voteCount, 1, "candidate 1 did not receive any votes");
      return electionInstance.candidates(2);
    }).then(function(candidate2) {
      var voteCount = candidate2[2];
      assert.equal(voteCount, 1, "candidate 2 did not receive any votes");
    });
  });

```

é¦–å…ˆï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ä¸€ä¸ªå°šæœªæŠ•ç¥¨çš„æ–°å¸æˆ·è®¾ç½®ä¸€ä¸ªæµ‹è¯•åœºæ™¯ã€‚ç„¶åæˆ‘ä»¬ä¼šä»£è¡¨ä»–ä»¬æŠ•ç¥¨ã€‚ç„¶åæˆ‘ä»¬å†è¯•ç€æŠ•ç¥¨ã€‚æˆ‘ä»¬å°†æ–­è¨€è¿™é‡Œå‘ç”Ÿäº†é”™è¯¯ã€‚æˆ‘ä»¬å¯ä»¥æ£€æŸ¥é”™è¯¯æ¶ˆæ¯ï¼Œå¹¶ç¡®ä¿æ²¡æœ‰å€™é€‰äººæ”¶åˆ°é€‰ç¥¨ï¼Œå°±åƒä¹‹å‰çš„æµ‹è¯•ä¸€æ ·ã€‚

ç°åœ¨è®©æˆ‘ä»¬è¿è¡Œæˆ‘ä»¬çš„æµ‹è¯•:

```js
$ truffle test
```

```
Yay, they pass! ğŸ‰
```js

### å®¢æˆ·ç«¯æŠ•ç¥¨

è®©æˆ‘ä»¬åœ¨â€œindex.htmlâ€æ–‡ä»¶ä¸­æ·»åŠ ä¸€ä¸ªå…è®¸å¸æˆ·åœ¨è¡¨æ ¼ä¸‹æ–¹æŠ•ç¥¨çš„è¡¨å•:

```
<form onSubmit="App.castVote(); return false;">
  <div class="form-group">
    <label for="candidatesSelect">Select Candidate</label>
    <select class="form-control" id="candidatesSelect">
    </select>
  </div>
  <button type="submit" class="btn btn-primary">Vote</button>
  <hr />
</form>

```js

è®©æˆ‘ä»¬æ£€æŸ¥ä¸€ä¸‹è¿™ä¸ªè¡¨å•çš„ä¸€äº›å†…å®¹:

1.  æˆ‘ä»¬ç”¨ä¸€ä¸ªç©ºçš„ select å…ƒç´ åˆ›å»ºè¡¨å•ã€‚æˆ‘ä»¬å°†åœ¨â€œapp.jsâ€æ–‡ä»¶ä¸­ä½¿ç”¨æ™ºèƒ½åˆåŒæä¾›çš„å€™é€‰äººæ¥å¡«å……é€‰æ‹©é€‰é¡¹ã€‚
2.  è¯¥è¡¨å•æœ‰ä¸€ä¸ªè°ƒç”¨â€œcastVoteâ€å‡½æ•°çš„â€œonSubmitâ€å¤„ç†ç¨‹åºã€‚æˆ‘ä»¬å°†åœ¨â€œapp.jsâ€æ–‡ä»¶ä¸­å¯¹æ­¤è¿›è¡Œå®šä¹‰ã€‚

ç°åœ¨è®©æˆ‘ä»¬æ›´æ–°æˆ‘ä»¬çš„ app.js æ–‡ä»¶æ¥å¤„ç†è¿™ä¸¤ä»¶äº‹ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬åœ¨è¡¨å•çš„ select å…ƒç´ ä¸­åˆ—å‡ºæ™ºèƒ½åˆåŒçš„æ‰€æœ‰å€™é€‰äººã€‚ç„¶åï¼Œä¸€æ—¦å¸æˆ·æŠ•ç¥¨ï¼Œæˆ‘ä»¬å°†éšè—é¡µé¢ä¸Šçš„è¡¨å•ã€‚æˆ‘ä»¬å°†æ›´æ–°æ¸²æŸ“å‡½æ•°ï¼Œå¦‚ä¸‹æ‰€ç¤º:

```
render: function() {
  var electionInstance;
  var loader = $("#loader");
  var content = $("#content");

  loader.show();
  content.hide();

  // Load account data
  web3.eth.getCoinbase(function(err, account) {
    if (err === null) {
      App.account = account;
      $("#accountAddress").html("Your Account: " + account);
    }
  });

  // Load contract data
  App.contracts.Election.deployed().then(function(instance) {
    electionInstance = instance;
    return electionInstance.candidatesCount();
  }).then(function(candidatesCount) {
    var candidatesResults = $("#candidatesResults");
    candidatesResults.empty();

    var candidatesSelect = $('#candidatesSelect');
    candidatesSelect.empty();

    for (var i = 1; i <= candidatesCount; i++) {
      electionInstance.candidates(i).then(function(candidate) {
        var id = candidate[0];
        var name = candidate[1];
        var voteCount = candidate[2];

        // Render candidate Result
        var candidateTemplate = "<tr><th>" + id + "</th><td>" + name + "</td><td>" + voteCount + "</td></tr>"
        candidatesResults.append(candidateTemplate);

        // Render candidate ballot option
        var candidateOption = "<option value='" + id + "' >" + name + "</ option>"
        candidatesSelect.append(candidateOption);
      });
    }
    return electionInstance.voters(App.account);
  }).then(function(hasVoted) {
    // Do not allow a user to vote
    if(hasVoted) {
      $('form').hide();
    }
    loader.hide();
    content.show();
  }).catch(function(error) {
    console.warn(error);
  });
}

```js

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è¦ç¼–å†™ä¸€ä¸ªå‡½æ•°ï¼Œæ¯å½“æäº¤è¡¨å•æ—¶éƒ½ä¼šè°ƒç”¨è¿™ä¸ªå‡½æ•°:

```
castVote: function() {
    var candidateId = $('#candidatesSelect').val();
    App.contracts.Election.deployed().then(function(instance) {
      return instance.vote(candidateId, { from: App.account });
    }).then(function(result) {
      // Wait for votes to update
      $("#content").hide();
      $("#loader").show();
    }).catch(function(err) {
      console.error(err);
    });
  }

```js

é¦–å…ˆï¼Œæˆ‘ä»¬åœ¨è¡¨å•ä¸­æŸ¥è¯¢ candidateIdã€‚å½“æˆ‘ä»¬ä»æ™ºèƒ½å¥‘çº¦ä¸­è°ƒç”¨ vote å‡½æ•°æ—¶ï¼Œæˆ‘ä»¬ä¼ é€’è¿™ä¸ª idï¼Œå¹¶å‘å½“å‰å¸æˆ·æä¾›å‡½æ•°çš„â€œfromâ€å…ƒæ•°æ®ã€‚è¿™å°†æ˜¯ä¸€ä¸ªå¼‚æ­¥è°ƒç”¨ã€‚å®Œæˆåï¼Œæˆ‘ä»¬å°†æ˜¾ç¤ºåŠ è½½å™¨å¹¶éšè—é¡µé¢å†…å®¹ã€‚æ¯å½“è®°å½•æŠ•ç¥¨æ—¶ï¼Œæˆ‘ä»¬å°†åå…¶é“è€Œè¡Œä¹‹ï¼Œå†æ¬¡å‘ç”¨æˆ·æ˜¾ç¤ºå†…å®¹ã€‚

ç°åœ¨ï¼Œæ‚¨çš„å‰ç«¯åº”ç”¨ç¨‹åºåº”è¯¥å¦‚ä¸‹æ‰€ç¤º:

![Voting Form](img/87f50b9c47d1d4e51ca85d5d0da8ffef.png)

ç»§ç»­å¹¶å°è¯•æŠ•ç¥¨åŠŸèƒ½ã€‚ä¸€æ—¦ä½ è¿™æ ·åšï¼Œä½ åº”è¯¥çœ‹åˆ°ä¸€ä¸ªå…ƒæ©ç ç¡®è®¤å¼¹å‡ºå¦‚ä¸‹:

![Metamask Confirmation](img/a58afeb0a6825525b54d0c026d259711.png)

ä¸€æ—¦ä½ ç‚¹å‡»æäº¤ï¼Œä½ å°±æˆåŠŸåœ°æŠ•äº†ä¸€ç¥¨ï¼æ‚¨ä»ä¼šçœ‹åˆ°ä¸€ä¸ªåŠ è½½å±å¹•ã€‚ç°åœ¨ï¼Œæ‚¨å¿…é¡»åˆ·æ–°é¡µé¢æ‰èƒ½çœ‹åˆ°è®°å½•çš„æŠ•ç¥¨ã€‚æˆ‘ä»¬å°†åœ¨ä¸‹ä¸€èŠ‚ä¸­å®ç°è‡ªåŠ¨æ›´æ–°åŠ è½½ç¨‹åºçš„åŠŸèƒ½ã€‚å¦‚æœä½ è¢«å¡ä½äº†ï¼Œä½ å¯ä»¥åœ¨è¿™é‡Œçš„æ•™ç¨‹[ä¸­å‚è€ƒå®Œæ•´çš„å®¢æˆ·ç«¯ä»£ç ã€‚](https://github.com/dappuniversity/election)

## è§‚å¯Ÿäº‹ä»¶-æ­¥éª¤ 4

è¿™éƒ¨åˆ†æ•™ç¨‹çš„è§†é¢‘ç‰‡æ®µä» [1:48:05](https://youtu.be/3681ZYbDSSk?t=1h48m05s) å¼€å§‹ã€‚ä½ å¯ä»¥åœ¨è¿™é‡Œä¸‹è½½è¿™éƒ¨åˆ†æ•™ç¨‹[çš„ä»£ç ã€‚å¦‚æœä½ å¡ä½äº†ï¼Œè¯·éšæ„ä½¿ç”¨è¿™äº›ä½œä¸ºå‚è€ƒç‚¹ï¼](https://github.com/dappuniversity/election/releases/tag/4-watch-events)

æœ¬æ•™ç¨‹çš„æœ€åä¸€æ­¥æ˜¯æ¯å½“æŠ•ç¥¨æ—¶è§¦å‘ä¸€ä¸ªäº‹ä»¶ã€‚è¿™å°†å…è®¸æˆ‘ä»¬åœ¨å¸æˆ·æŠ•ç¥¨æ—¶æ›´æ–°æˆ‘ä»¬çš„å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºã€‚å¹¸è¿çš„æ˜¯ï¼Œè¿™ç›¸å½“å®¹æ˜“ã€‚è®©æˆ‘ä»¬é¦–å…ˆåƒè¿™æ ·åœ¨æˆ‘ä»¬çš„å¥‘çº¦ä¸­å£°æ˜ä¸€ä¸ªäº‹ä»¶:

```
contract Election {
    // ...
    event votedEvent (
        uint indexed _candidateId
    );
    // ...
}

```js

ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨â€œæŠ•ç¥¨â€å‡½æ•°ä¸­è§¦å‘è¿™ä¸ªâ€œæŠ•ç¥¨â€äº‹ä»¶ï¼Œå¦‚ä¸‹æ‰€ç¤º:

```
function vote (uint _candidateId) public {
    // require that they haven't voted before
    require(!voters[msg.sender]);

    // require a valid candidate
    require(_candidateId > 0 && _candidateId <= candidatesCount);

    // record that voter has voted
    voters[msg.sender] = true;

    // update candidate vote Count
    candidates[_candidateId].voteCount ++;

    // trigger voted event
    votedEvent(_candidateId);
}

```js

æ—¢ç„¶æˆ‘ä»¬å·²ç»æ›´æ–°äº†åˆåŒï¼Œæˆ‘ä»¬å¿…é¡»è¿è¡Œæˆ‘ä»¬çš„è¿ç§»:

```
$ truffle migrate --reset
```js

æˆ‘ä»¬ä¹Ÿå¯ä»¥åƒè¿™æ ·æ›´æ–°æˆ‘ä»¬çš„æµ‹è¯•æ¥æ£€æŸ¥è¿™ä¸ªæŠ•ç¥¨äº‹ä»¶:

```
it("allows a voter to cast a vote", function() {
  return Election.deployed().then(function(instance) {
    electionInstance = instance;
    candidateId = 1;
    return electionInstance.vote(candidateId, { from: accounts[0] });
  }).then(function(receipt) {
    assert.equal(receipt.logs.length, 1, "an event was triggered");
    assert.equal(receipt.logs[0].event, "votedEvent", "the event type is correct");
    assert.equal(receipt.logs[0].args._candidateId.toNumber(), candidateId, "the candidate id is correct");
    return electionInstance.voters(accounts[0]);
  }).then(function(voted) {
    assert(voted, "the voter was marked as voted");
    return electionInstance.candidates(candidateId);
  }).then(function(candidate) {
    var voteCount = candidate[2];
    assert.equal(voteCount, 1, "increments the candidate's vote count");
  })
});

```js

è¯¥æµ‹è¯•æ£€æŸ¥ç”±â€œvoteâ€å‡½æ•°è¿”å›çš„äº¤æ˜“æ”¶æ®ï¼Œä»¥ç¡®ä¿å®ƒæœ‰æ—¥å¿—ã€‚è¿™äº›æ—¥å¿—åŒ…å«è§¦å‘çš„äº‹ä»¶ã€‚æˆ‘ä»¬æ£€æŸ¥äº‹ä»¶çš„ç±»å‹æ˜¯å¦æ­£ç¡®ï¼Œä»¥åŠå®ƒæ˜¯å¦æœ‰æ­£ç¡®çš„å€™é€‰ idã€‚

ç°åœ¨è®©æˆ‘ä»¬æ›´æ–°å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºæ¥ç›‘å¬æŠ•ç¥¨äº‹ä»¶ï¼Œå¹¶åœ¨å®ƒè¢«è§¦å‘æ—¶è§¦å‘é¡µé¢åˆ·æ–°ã€‚æˆ‘ä»¬å¯ä»¥ç”¨å¦‚ä¸‹çš„â€œlistenForEventsâ€å‡½æ•°æ¥å®ç°:

```
listenForEvents: function() {
  App.contracts.Election.deployed().then(function(instance) {
    instance.votedEvent({}, {
      fromBlock: 0,
      toBlock: 'latest'
    }).watch(function(error, event) {
      console.log("event triggered", event)
      // Reload when a new vote is recorded
      App.render();
    });
  });
}

```js

è¿™ä¸ªå‡½æ•°åšä¸€äº›äº‹æƒ…ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬é€šè¿‡è°ƒç”¨â€œvoted eventâ€å‡½æ•°æ¥è®¢é˜…æŠ•ç¥¨äº‹ä»¶ã€‚æˆ‘ä»¬ä¼ å…¥ä¸€äº›å…ƒæ•°æ®ï¼Œå‘Šè¯‰æˆ‘ä»¬è¦ç›‘å¬åŒºå—é“¾ä¸Šçš„æ‰€æœ‰äº‹ä»¶ã€‚ç„¶åæˆ‘ä»¬â€œçœ‹â€è¿™ä¸ªäº‹ä»¶ã€‚åœ¨è¿™é‡Œï¼Œæ¯å½“è§¦å‘â€œvotedEventâ€æ—¶ï¼Œæˆ‘ä»¬éƒ½ä¼šè®°å½•åˆ°æ§åˆ¶å°ã€‚æˆ‘ä»¬è¿˜é‡æ–°å‘ˆç°é¡µé¢ä¸Šçš„æ‰€æœ‰å†…å®¹ã€‚è¿™å°†åœ¨æŠ•ç¥¨è®°å½•å®Œæˆååˆ é™¤åŠ è½½å™¨ï¼Œå¹¶åœ¨è¡¨æ ¼ä¸Šæ˜¾ç¤ºæ›´æ–°åçš„æŠ•ç¥¨æ•°ã€‚

æœ€åï¼Œæ— è®ºä½•æ—¶åˆå§‹åŒ–å¥‘çº¦ï¼Œæˆ‘ä»¬éƒ½å¯ä»¥è°ƒç”¨è¿™ä¸ªå‡½æ•°:

```
initContract: function() {
  $.getJSON("Election.json", function(election) {
    // Instantiate a new truffle contract from the artifact
    App.contracts.Election = TruffleContract(election);
    // Connect provider to interact with contract
    App.contracts.Election.setProvider(App.web3Provider);

    App.listenForEvents();

    return App.render();
  });
}

```

ç°åœ¨ï¼Œæ‚¨å¯ä»¥åœ¨æ‚¨çš„å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºä¸ŠæŠ•ç¥¨ï¼Œå¹¶å®æ—¶è§‚çœ‹è®°å½•çš„æŠ•ç¥¨ï¼è¯·è€å¿ƒç­‰å¾…ï¼Œäº‹ä»¶è§¦å‘å¯èƒ½éœ€è¦å‡ ç§’é’Ÿæ—¶é—´ã€‚å¦‚æœæ‚¨æ²¡æœ‰çœ‹åˆ°äº‹ä»¶ï¼Œè¯·å°è¯•é‡æ–°å¯åŠ¨ Chromeã€‚å›´ç»•äº‹ä»¶çš„å…ƒæ©ç æœ‰ä¸€ä¸ªå·²çŸ¥é—®é¢˜[ã€‚é‡å¯ Chrome æ€»èƒ½å¸®æˆ‘æå®šã€‚](https://github.com/MetaMask/metamask-extension/issues/2393)

æ­å–œä½ ï¼ğŸ‰æ‚¨å·²ç»åœ¨ä»¥å¤ªåŠåŒºå—é“¾ä¸ŠæˆåŠŸæ„å»ºäº†ä¸€ä¸ªå…¨æ ˆåˆ†æ•£å¼åº”ç”¨ç¨‹åºï¼ä½ å¯ä»¥åœ¨è¿™é‡Œä¸‹è½½æœ¬æ•™ç¨‹çš„å®Œæ•´æºä»£ç [ï¼Œåœ¨è¿™é‡Œ](https://github.com/dapp_university/election)è§‚çœ‹å®Œæ•´è§†é¢‘[ã€‚](https://www.youtube.com/watch?v=3681ZYbDSSk)

å¯¹è¿™ä¸ªæ•™ç¨‹æ»¡æ„å—ï¼Ÿç„¶åä½ **éœ€è¦**åˆ°[åœ¨è¿™é‡Œå‚åŠ æˆ‘çš„å…è´¹åŸ¹è®­](/bootcamp)ï¼Œæˆ‘å°†å‘ä½ å±•ç¤ºå¦‚ä½•æ„å»ºä¸€ä¸ªçœŸå®ä¸–ç•Œçš„åŒºå—é“¾åº”ç”¨ç¨‹åºï¼Œè¿™æ ·ä½ å°±å¯ä»¥æˆä¸ºä¸€åé«˜è–ªçš„åŒºå—é“¾å¼€å‘è€…ï¼

*